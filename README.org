#+TITLE: Emacs Configurations
#+AUTHOR: Justin Jose

#+HTML:<div align=center><a href="https://gitlab.com/t3pleni9/emacs-d"><img alt="Emacs Logo" width="60" height="60" src="https://upload.wikimedia.org/wikipedia/commons/0/08/EmacsIcon.svg"></a>

A nifty [[https://orgmode.org/worg/org-contrib/babel/][org-babel]] Emacs configuration.

#+HTML:</div>
* Installation
** EMACS 
Follow the [[https://www.gnu.org/software/emacs/download.html][Download & installation]] guide to setup vanilla emacs.
 This config is based on Emacs v26.1, versions newer than this might require a modified approach for installation and configuration.
** Configuration
To install, clone this repository, and replace it with the =.emacs.d= in your =$HOME= directory, for EMACS <= v26.1
#+begin_src bash
cd ~
mv .emacs.d .emacs.d.bkp # Always make backups
git clone https://github.com/t3pleni9/emacs.d.git
mv emacs.d .emacs.d
#+end_src

Post cloning and installation, start EMACS. The initial setup will take some time as it would download the relevant packages and install it. 
Along with regular packages, clone the following packages into =<EMACS-config-root>/external/= to utilise their respective functionalities.
- https://github.com/t3pleni9/emacs-totp.git :: Support of Time based OTP (TOTP) for org-password
- https://gitlab.com/t3pleni9/py-build.git :: Integrates PyBuild with  projectile and anaconda-venv
* Common Require
  Includes all the requires accross multiple machines
  - [ ] Need to handle personal git projects
  #+begin_src emacs-lisp
    (require 'org)
    (require 'auto-complete)
    (require 'projectile)
    (require 'all-the-icons)
    (require 'multiple-cursors)
    (require 'virtualenvwrapper)
    (require 'helm)
    (require 'helm-projectile)
    (require 'helm-swoop)
    (require 'json-mode)
    (require 'scroll-bar)
    (require 'async nil :noerror)
    (require 'org-bullets)
    (require 'smart-mode-line)
    (require 'dumb-jump)
    (require 'iedit)
    (require 'rust-mode)
    (require 'org-super-agenda)
    (require 'pyb)
    (require 'image+)
    (require 'dashboard)
    (require 'view)
    (require 'ein)
    (require 'ein-notebook)
    (require 'org-alert)
    (require 'alert)
    (require 'define-word)
    (require 'wrap-region)
    (require 'eshell-prompt-extras)
    (require 'smartscan)
    (require 'org-notify nil :noerror)
    (require 'org-present)
    (require 'eww)
    (require 'pdf-view-restore)
    (require 'org-habit)
    (require 'ob-elixir)
    (require 'elixir-mode)
    (require 'org-pomodoro)
    (require 'zone)
    (require 'hydra)
    (require 'org-noter)
    (require 'org-ref)
    (require 'org-ref-pdf)
    (require 'org-ref-url-utils)
    (require 'org-ref-arxiv)
    (require 'scala-mode)
    (require 'typescript-mode)
    (require 'god-mode) 
    (require 'indent-bars)
    (require 'kkp)
  #+end_src

* Require: Laptop
#+begin_src emacs-lisp
    (when (system-is-laptop)
      (require 'emms-setup)
      (require 'emms-mode-line)
      (require 'emms-player-mpv)
      (require 'volume)    
      (require 'calfw-org)
      (require 'emacs-totp)
      (require 'org-roam)
      (require 'org-roam-server)
      (require 'deft)
      (require 'org-password-manager))
#+end_src

* Emacs startup, and others
** Path setting: Laptop
#+begin_src emacs-lisp :results output
(when (system-is-laptop)
  (setenv "PATH" (concat (getenv "PATH") ":/Library/TeX/texbin" ":/Users/justinjose/.miniconda/bin" ":/Users/justinjose/.local/bin" ":/Users/justinjose/go/bin"))
  (setq exec-path (append exec-path '("/usr/local/bin" "/Users/justinjose/go/bin"))))
#+end_src

#+RESULTS:

** Path setting: workstation
#+begin_src emacs-lisp
(when (system-is-workstation)
  (setq exec-path (append exec-path '("/usr/local/bin"))))
#+end_src

** Themes
Loading Theme post every operation
#+begin_src emacs-lisp
  (load-theme 'darktooth t)
  (load-theme 'smart-mode-line-dark t)
#+end_src

Flatten the wavy red underlines for error
#+begin_src emacs-lisp
  ;; no waves, use underlines which look better
  (defun theme-tweaks-flatten-underline+ (face)
    "Change underline style of FACE from wave to straight line."
    (let ((underline (face-attribute face :underline)))
      (when (eq (plist-get underline :style) 'wave)
        (plist-put underline :style 'line)
        (set-face-attribute face nil :underline underline))))

  ;; initial flattening
  (mapatoms (lambda (atom)
              (when (facep atom)
                (theme-tweaks-flatten-underline+ atom))))

  ;; flatten on each face definition in the future
  (define-advice custom-declare-face (:around (fun &rest args) flatten-face)
    (let ((face (apply fun args)))
      (theme-tweaks-flatten-underline+ face)
      face))
#+end_src

** Global
#+begin_src emacs-lisp
  (setq inhibit-startup-message t) ;; outline-hide the startup messag
  (menu-bar-mode -1)
  (tool-bar-mode -1)
  (scroll-bar-mode -1)
  (elpy-enable)
  (when (system-is-laptop)
    (setq elpy-rpc-virtualenv-path 'current)
    (setq json-encoding-pretty-print nil))
  (epa-file-enable)

  (setenv "PATH" (concat (getenv "PATH") ":/usr/local/bin/"))
  (sml/setup)
  (setq sml/no-confirm-load-theme t)
#+end_src


Disable Backup
#+begin_src emacs-lisp
(setq make-backup-files nil)
#+end_src

Make life a little bit more easier
#+begin_src emacs-lisp
(defalias 'yes-or-no-p 'y-or-n-p)
(setq echo-keystrokes 0.1)
#+end_src

Always split vertically
#+begin_src emacs-lisp
(setq split-height-threshold 200)
(setq split-width-threshold 200)
#+end_src

Full screen, and server
#+begin_src emacs-lisp
  (toggle-frame-fullscreen)
  ;; (unless (daemonp) (server-mode t))
#+end_src

Garbage Collection
#+begin_src emacs-lisp
(add-hook 'focus-out-hook #'garbage-collect)
#+end_src

Danger Scripts
#+begin_src emacs-lisp
(put 'narrow-to-region 'disabled nil)
(put 'dired-find-alternate-file 'disabled nil)
#+end_src

Make shell not to repeat commands
#+begin_src emacs-lisp
(setq comint-process-echoes t)
#+end_src

Set the font to a comfortable level
#+begin_src emacs-lisp
  (set-face-attribute 'default nil :height 130)
  (setq-default line-spacing 1)
  (when (system-is-laptop)
    (set-frame-font "Hack 13" nil t))
#+end_src

Dired stuffs
#+begin_src emacs-lisp
(setq dired-dwim-target t)
#+end_src

 Zone out 
 #+begin_src emacs-lisp
 ;(zone-when-idle 600)
 #+end_src

Unicode character support
#+begin_src emacs-lisp
  (require 'unicode-fonts)
  (when (system-is-laptop)
    (setq unicode-fonts-block-font-mapping
          '(("Emoticons"
       ("Apple Color Emoji" "Symbola" "Quivira")))
          unicode-fonts-fontset-names '("fontset-default")))
    (unicode-fonts-setup)
#+end_src

Don't kill emacs without confirming
#+begin_src emacs-lisp
(setq confirm-kill-emacs 'y-or-n-p)
#+end_src

Show alerts in notifier
#+begin_src emacs-lisp
  (when (system-is-laptop)
    (setq alert-default-style 'osx-notifier))
  (when (system-is-workstation)
    (setq alert-default-style 'growl))
#+end_src

Easier marking for TMM
#+begin_src emacs-lisp
(defun push-mark-no-activate ()
  "Pushes `point' to `mark-ring' and does not activate the region
   Equivalent to \\[set-mark-command] when \\[transient-mark-mode] is disabled"
  (interactive)
  (push-mark (point) t nil)
  (message "Pushed mark to ring"))
#+end_src


** Terminal clipboard
#+begin_src emacs-lisp
  (defadvice kill-ring-save (before copy-to-system-in-tty activate) 
    (pcase system-type  
      ('gnu/linux
       (call-process-region (ad-get-arg 0) (ad-get-arg 1) "xsel" nil nil nil "-ib"))  
      ('darwin
       (call-process-region (ad-get-arg 0) (ad-get-arg 1) "pbcopy" nil nil nil))  ))
#+end_src

** Dashboard
#+begin_src emacs-lisp
(dashboard-setup-startup-hook)
;; Set the title
(setq dashboard-banner-logo-title "Dashboard")

;; Set the banner
(setq dashboard-startup-banner "~/.emacs.d/external/t9-logo.png")
(setq dashboard-items '((recents  . 5)
                        (agenda . 10)
                        (projects . 5)
                        (bookmarks . 5)))
#+end_src

** Date and Time 
Have time displayed in status bar
#+begin_src emacs-lisp
(setq display-time-string-forms
       '((propertize (concat dayname " " day  " "  monthname " " 12-hours ":" minutes " "  am-pm)
 		    'face 'bold)))

#+end_src

** Python
Setup python venv with conda
#+begin_src emacs-lisp

  (venv-initialize-interactive-shells) ;; if you want interactive shell support
  (venv-initialize-eshell) ;; if you want eshell support
  (when (system-is-laptop)
    (setq venv-location "~/.miniconda/envs")
    (setenv "WORKON_HOME" "~/.miniconda/envs"))

  (when (system-is-workstation)
    (setq venv-location "~/miniconda3/envs")
    (setenv "WORKON_HOME" "~/miniconda3/envs"))
#+end_src

#+begin_src emacs-lisp
  (use-package indent-bars
    :hook ((python-mode yaml-mode) . indent-bars-mode))
#+end_src  


** Jupyter Notebooks
Set jupyter executable path and Notebook path
#+begin_src emacs-lisp
(setq ein:jupyter-default-server-command "~/.local/bin/jupyter"
ein:jupyter-default-notebook-directory "~/Documents/Notebook")
#+end_src

Enable in-lined images in EIN
#+begin_src emacs-lisp
(setq ein:output-area-inlined-images t)
#+end_src

** GoLang
#+begin_src emacs-lisp
(setq company-idle-delay 0)
(setq company-minimum-prefix-length 1)

;; Go - lsp-mode
;; Set up before-save hooks to format buffer and add/delete imports.
(defun lsp-go-install-save-hooks ()
  (add-hook 'before-save-hook #'lsp-format-buffer t t)
  (add-hook 'before-save-hook #'lsp-organize-imports t t))
(add-hook 'go-mode-hook #'lsp-go-install-save-hooks)

;; Start LSP Mode and YASnippet mode
(add-hook 'go-mode-hook #'lsp-deferred)
(add-hook 'go-mode-hook #'yas-minor-mode)
#+end_src

#+RESULTS:

** EMMS

   EMMS is only defined for laptop
#+begin_src emacs-lisp
(when (system-is-laptop)
#+end_src

Constants and File Paths
#+begin_src emacs-lisp
(setq default-playlist "~/Documents/Work.m3u")
(setq emms-playlist-buffer-name "*EMMS*")
#+end_src

Basic Setup
#+begin_src emacs-lisp
  (emms-standard)
  (emms-default-players)
  (add-to-list 'emms-player-list 'emms-player-mpv)

  (emms-mode-line 1)

  (emms-add-playlist default-playlist)
  (emms-shuffle)
#+end_src
#+begin_src emacs-lisp
  (defun my/reload-playlist ()
    (interactive)
    (emms-play-playlist default-playlist)
    (emms-shuffle))
#+end_src

Fix the mode-line to just the Track name
#+begin_src emacs-lisp
  (setq emms-mode-line-mode-line-function
        (lambda nil
          (propertize " [♫]" 'face (list :foreground "#8080f0" :weight 'bold)))))
#+end_src

** TRAMP
#+begin_src emacs-lisp
  ;; (defun add-ssh-agent-to-tramp ()
  ;;   (cl-pushnew '("-A")
  ;;               (cadr (assoc 'tramp-login-args
  ;;                            ; if on Windows using Putty with Pageant,
  ;;                            ; replace "ssh" with "plink"
  ;;                            (assoc "ssh" tramp-methods)))
  ;;               :test #'equal))
  ;; (add-ssh-agent-to-tramp)
(require 'tramp)
(setq tramp-default-method "ssh")
#+end_src

** eShell

Pager setup

#+begin_src emacs-lisp
(setenv "PAGER" "cat")
#+end_src

Basic sanity setup
#+begin_src emacs-lisp
(setq eshell-save-history-on-exit t)
(add-hook 'eshell-mode-hook
            (lambda ()
              (add-to-list 'eshell-visual-commands "ssh")
              (add-to-list 'eshell-visual-commands "tail")
              (add-to-list 'eshell-visual-commands "htop")))
#+end_src


GIT
#+begin_src emacs-lisp
(defun eshell/gst (&rest args)
    (magit-status (pop args) nil)
    (eshell/echo))   ;; The echo command suppresses output

(defun my/epe-git-staged ()
  "Return number of staged files"
  (if (string-match "0"
                    (shell-command-to-string "git diff --cached --numstat | wc -l"))
      "" epe-git-dirty-char))

(defun my/epe-git-dirty ()
  "Return number of staged files"
  (if (string-match "0"
                    (shell-command-to-string "git diff --numstat | wc -l"))
      "" epe-git-dirty-char))

(defun my/epe-git-untracked ()
  (if (epe-git-untracked-p) epe-git-untracked-char ""))

(defun my/git-commit-count () 
  (let ((unpushed (epe-git-unpushed-number)))
                 (if (= unpushed 0) ""
                   (concat ":" (number-to-string unpushed)))))

#+end_src

Eshell [[https://www.masteringemacs.org/article/complete-guide-mastering-eshell#to-pseudo-devices][re-directions]]


The usual redirection rules like overwrite (~>~) and append (~>>~) apply here.

~echo $PATH > #<buffer *scratch*>~ 
To Buffers

~/dev/eshell~
Prints the output interactively to Eshell.

~/dev/null~
Sends the output to the NULL device.

~/dev/clip~
Sends the output to the clipboard.

~/dev/kill~
Sends the output to the kill ring.



Eshell theme and formating

#+begin_src emacs-lisp
(defun my/epe-theme-lambda ()
  "A eshell-prompt lambda theme."
  (setq eshell-prompt-regexp "^[^#\nλ]*[#λ] ")
  (concat
   (when (epe-remote-p)
     (epe-colorize-with-face
      (concat (epe-remote-user) "@" (epe-remote-host) " ")
      'epe-remote-face))
   (let ((env-current-name (or (get-venv-name)
                               (bound-and-true-p conda-env-current-name))))
     (when (and epe-show-python-info (bound-and-true-p env-current-name))
       (epe-colorize-with-face (concat "(" env-current-name ") ") 'epe-venv-face)))
   (let ((f 'epe-abbrev-dir-name))
     (epe-colorize-with-face (funcall f (eshell/pwd)) 'epe-dir-face))
   (when (epe-git-p)
     (concat " ["
      (epe-colorize-with-face (epe-git-branch) 'epe-git-face) " "
      (epe-colorize-with-face (my/epe-git-staged) '(:foreground "#3C3"))
      (epe-colorize-with-face (my/epe-git-dirty) '(:foreground "Orange"))
      (epe-colorize-with-face (my/epe-git-untracked) '(:foreground "#C33"))
      (epe-colorize-with-face (my/git-commit-count) 'epe-git-face) "]"))
   (epe-colorize-with-face " λ" 'epe-symbol-face)
   (epe-colorize-with-face (if (= (user-uid) 0) "#" "") 'epe-sudo-symbol-face)
   " "))
#+end_src

#+begin_src emacs-lisp
  (with-eval-after-load "esh-opt"
    (setq eshell-highlight-prompt nil
          eshell-prompt-function 'my/epe-theme-lambda
          epe-git-dirty-char "●"
          epe-git-untracked-char "●"))

#+end_src


Wrapper function to update ~venv-current-name~ whenever venv is activated or deactivate
#+begin_src emacs-lisp
  (defun my/pyvenv-workon () 
    (interactive)
    (call-interactively #'pyvenv-workon)
    (setq venv-current-name (get-venv-name)))

#+end_src

#+begin_src emacs-lisp
  (defun my/pyvenv-deactivate () 
    (interactive)
    (call-interactively #'pyvenv-deactivate)
    (setq venv-current-name (get-venv-name)))

#+end_src


#+begin_src emacs-lisp
(defun get-venv-name ()
  (let* ((virtual-env (split-string (car process-environment) "=")))
	 (if (equalp (first virtual-env) "VIRTUAL_ENV") (car (last (split-string (car (last virtual-env)) "/"))))))
#+end_src

** Functions
Launch Process with custom buffer name
#+begin_src emacs-lisp
(defun my/launch-process (name buffer-name process &rest args) 
(apply #'start-process name buffer-name process args)
(with-current-buffer buffer-name
        (local-set-key (kbd "C-c C-c") (lambda () (interactive) (kill-process))))
)
#+end_src

** Custom Minor Modes
Sensitive Mode
#+begin_src emacs-lisp
  (setq sensitive-extensions '("gpg"))
  (define-minor-mode sensitive-mode
    "For sensitive files like password lists.
  It disables backup creation and auto saving.

  With no argument, this command toggles the mode.
  Non-null prefix argument turns on the mode.
  Null prefix argument turns off the mode."
    ;; The initial value.
    nil
    ;; The indicator for the mode line.
    " Sensitive"
    ;; The minor mode bindings.
    nil
    (if (symbol-value sensitive-mode)
        (progn
    ;; disable backups
    (set (make-local-variable 'backup-inhibited) t)
    ;; disable undo-tree-mode
    (global-undo-tree-mode -1)
    (undo-tree-mode -1)
    ;; disable auto-save
    (if auto-save-default
            (progn
              (auto-save-mode -1)
              (auto-save-visited-mode -1))))
      ;resort to default value of backup-inhibited
      (kill-local-variable 'backup-inhibited)
      ;; disable undo-tree-mode
      (global-undo-tree-mode t)
      (undo-tree-mode t)
      (if auto-save-default
            (progn
              (auto-save-mode t)
              (auto-save-visited-mode t)))))
#+end_src

#+RESULTS:

** Scala
#+begin_src emacs-lisp
  (use-package scala-mode
    :interpreter ("scala" . scala-mode)
    :mode "\\.s\\(cala\\|bt\\)$")
#+end_src

Fix indentation issues for =scala-3= while using =scala-mode=
Following the configuration code in [[https://sideshowcoder.com/2021/12/30/new-scala-3-syntax-in-emacs/][New Scala 3 syntax in Emacs]]
#+begin_src emacs-lisp
  (defun is-scala3-project ()
    "Check if the current project is using scala3.

  Loads the build.sbt file for the project and serach for the scalaVersion."
    (projectile-with-default-dir (projectile-project-root)
      (when (file-exists-p "build.sbt")
        (with-temp-buffer
          (insert-file-contents "build.sbt")
          (search-forward "scalaVersion := \"3" nil t)))))

  (defun with-disable-for-scala3 (orig-scala-mode-map:add-self-insert-hooks &rest arguments)
      "When using scala3 skip adding indention hooks."
      (unless (is-scala3-project)
        (apply orig-scala-mode-map:add-self-insert-hooks arguments)))

  (advice-add #'scala-mode-map:add-self-insert-hooks :around #'with-disable-for-scala3)

  (defun disable-scala-indent ()
    "In scala 3 indent line does not work as expected due to whitespace grammar."
    (when (is-scala3-project)
      (setq indent-line-function 'indent-relative-maybe)))

  (add-hook 'scala-mode-hook #'disable-scala-indent)
#+end_src

#+RESULTS:
| disable-scala-indent |

* Global Modes
** Global

#+begin_src emacs-lisp
  (auto-save-visited-mode t)
  (global-visual-line-mode t)
  (column-number-mode t)
  (global-kkp-mode t)

  (set-cursor-color "#6785c5") 
  (helm-mode 1)
  (pyvenv-mode 1)
  (electric-pair-mode t)
  (global-undo-tree-mode)
  (rainbow-delimiters-mode 1)
  (show-paren-mode 1)
  (setq show-paren-delay 0)
  (wrap-region-global-mode 1)
  (delete-selection-mode 1)
  (org-super-agenda-mode 1)
  (customize-set-variable 'helm-ff-lynx-style-map t)

  (setq-default display-line-numbers-width 2
                display-line-numbers-widen t
                tab-width 2
                indent-tabs-mode nil)

  (display-time-mode 1)
  (when (system-is-laptop)
    (org-roam-mode 1))
  (org-notify-start)
  (setq undo-tree-history-directory-alist '(("." . "~/.emacs.d/.undo-tree/")))
#+end_src

God mode

#+begin_src emacs-lisp

  ;; (global-set-key (kbd "<escape>") #'god-mode) 
  ;; Update cursor
  (defun my-god-mode-update-cursor ()
    (setq cursor-type (if (or god-local-mode buffer-read-only)
                        'bar
                        'box)))
  (add-hook 'god-mode-enabled-hook #'my-god-mode-update-cursor)
  (add-hook 'god-mode-disabled-hook #'my-god-mode-update-cursor)


  ;; Update mode-line
  (defun my-god-mode-enabled-modeline () 
      (set-face-background 'mode-line "#5555ff")
  )
  (defun my-god-mode-disabled-modeline () 
      (set-face-background 'mode-line "#0a2832")
  )
  (add-hook 'god-mode-enabled-hook #'my-god-mode-enabled-modeline)
  (add-hook 'god-mode-disabled-hook #'my-god-mode-disabled-modeline)

#+end_src

#+RESULTS:

Disable line numbers in some buffers
#+begin_src emacs-lisp :results output
 (defun display-line-numbers-disable-hook ()
  "Disable display-line-numbers locally."
  (display-line-numbers-mode 0))

 (add-hook 'maggit-mode-hook 'display-line-numbers-disable-hook)
 (add-hook 'org-mode-hook 'display-line-numbers-disable-hook)
 (add-hook 'dashboard-mode-hook 'display-line-numbers-disable-hook)
 (add-hook 'pdf-tools-enabled-hook 'display-line-numbers-disable-hook)
 (add-hook 'doc-view-mode-hook 'display-line-numbers-disable-hook)
 (add-hook 'vterm-mode-hook 'display-line-numbers-disable-hook)
#+end_src

#+RESULTS:

Disable visual line mode in some buffers
#+begin_src emacs-lisp

(defun disable-visual-line-mode ()
  "Disable display-line-numbers locally."
   (visual-line-mode -1))

(add-hook 'minibuffer-setup-hook 'disable-visual-line-mode)

#+end_src

#+RESULTS:

Org export support
#+begin_src emacs-lisp
  (when (system-is-laptop)
    (setq doc-view-ghostscript-program "/usr/local/bin/gs"))
#+end_src

Image view mode
#+begin_src emacs-lisp
(eval-after-load 'image+ '(imagex-global-sticky-mode 1))
#+end_src

Disable new line mode for csv files as it defeats the purpose of align items
#+begin_src emacs-lisp
(add-hook 'csv-mode-hook
          (lambda ()
            (visual-line-mode 1)
            (toggle-truncate-lines 1)))

(add-hook 'deft-mode-hook
          (lambda ()
            (visual-line-mode 1)
            (toggle-truncate-lines 1)))
#+end_src

** EPUB mode setting
Basic setting
#+begin_src emacs-lisp
(add-to-list 'auto-mode-alist '("\\.epub\\'" . nov-mode))
(setq nov-text-width t)
(add-hook 'nov-mode-hook 'visual-line-mode)
(add-hook 'nov-mode-hook 'visual-fill-column-mode)
#+end_src


#+begin_src emacs-lisp
(require 'justify-kp)
(setq nov-text-width t)

(defun my-nov-window-configuration-change-hook ()
  (my-nov-post-html-render-hook)
  (remove-hook 'window-configuration-change-hook
               'my-nov-window-configuration-change-hook
               t))

(defun my-nov-post-html-render-hook ()
  (if (get-buffer-window)
      (let ((max-width (pj-line-width))
            buffer-read-only)
        (save-excursion
          (goto-char (point-min))
          (while (not (eobp))
            (when (not (looking-at "^[[:space:]]*$"))
              (goto-char (line-end-position))
              (when (> (shr-pixel-column) max-width)
                (goto-char (line-beginning-position))
                (pj-justify)))
            (forward-line 1))))
    (add-hook 'window-configuration-change-hook
              'my-nov-window-configuration-change-hook
              nil t)))

(add-hook 'nov-post-html-render-hook 'my-nov-post-html-render-hook)
#+end_src

** Prog-Mode

Standard Indent value to 2
#+begin_src emacs-lisp
(setq-default standard-indent 2)
#+end_src

Make line numbers relative
#+begin_src emacs-lisp
  (defun enable-relative-line-numbers-hook ()
      (display-line-numbers-mode)
      (setq display-line-numbers 'relative))
#+end_src

Programming Mode Hooks
#+begin_src emacs-lisp
  (add-hook 'prog-mode-hook #'enable-relative-line-numbers-hook)
  (add-hook 'yaml-mode-hook #'enable-relative-line-numbers-hook)
  (add-hook 'prog-mode-hook #'rainbow-delimiters-mode)
  (add-hook 'prog-mode-hook #'yafolding-mode)
  (add-hook 'json-mode-hook #'yafolding-mode)
  (add-hook 'nxml-mode-hook #'yafolding-mode)
  (add-hook 'bibtex-mode-hook #'yafolding-mode)
  (add-to-list 'auto-mode-alist '("\\.rs\\'" . rust-mode))
  ;; (add-hook 'prog-mode-hook 'linum-mode)


#+end_src

*** JavaScript
JavaScript specific setups
#+begin_src emacs-lisp
    (add-to-list 'auto-mode-alist '("\\.js\\'" . js2-mode))
    (add-to-list 'auto-mode-alist '("\\.jsx\\'" . web-mode))
    (setq web-mode-content-types-alist '(("jsx" . "\\.js[x]?\\'")))
    (add-to-list 'interpreter-mode-alist '("node" . js2-mode))
    (setq js-indent-level 2
          web-mode-code-indent-offset 2
          web-mode-markup-indent-offset 2
          web-mode-css-indent-offset 2)
#+end_src

CSS
#+begin_src emacs-lisp
(setq css-indent-offset 2)
#+end_src

*** Python
Python Specific Setups
#+begin_src emacs-lisp
(add-hook 'python-mode-hook 'anaconda-mode)
(add-hook 'python-mode-hook 'anaconda-eldoc-mode)
(add-hook 'python-mode-hook (lambda () (auto-complete-mode -1)))
#+end_src

Setting iPython as the default REPL for python
#+begin_src emacs-lisp
(setq python-shell-interpreter "ipython"
python-shell-interpreter-args "--simple-prompt -i")

(add-hook 'inferior-python-mode-hook 'no-trailing-whitespace)
(add-hook 'inferior-python-mode-hook
          '(lambda ()
             (setq-local ml-interactive? t)))
#+end_src

Ensure that each project has its own python shell and Change the virtual environment according to the project
#+begin_src emacs-lisp
(add-hook 'elpy-mode-hook (lambda () (elpy-shell-set-local-shell (elpy-project-root))))
(pyvenv-tracking-mode)
#+end_src
*** LISP
#+begin_src example
(load (expand-file-name "~/.quicklisp/slime-helper.el"))
(setq inferior-lisp-program "sbcl")
#+end_src

** Projectile
Enable Projectile Globally
#+begin_src emacs-lisp
(projectile-global-mode)
(helm-projectile-toggle 1)
(setq projectile-enable-caching t)
#+end_src

Projectile default search path and indexing
#+begin_src emacs-lisp
(setq projectile-project-search-path '("~/Documents/Projects/"))
(setq projectile-indexing-method 'alien)
#+end_src


Bind switch project to =helm-projectile=
#+begin_src emacs-lisp
(setq projectile-switch-project-action 'helm-projectile)
#+end_src

** Shell
Setup shell setting to work with zsh
#+begin_src emacs-lisp
  (when (system-is-laptop)
    (setq explicit-shell-file-name "/bin/zsh"))
  (when (system-is-workstation)
    (setq explicit-shell-file-name "usr/bin/zsh"))
  (setq shell-file-name "zsh")
  (setq explicit-bash.exe-args '("--noediting" "--login" "-i"))
  (setenv "SHELL" shell-file-name)
  (add-hook 'comint-output-filter-functions 'comint-strip-ctrl-m)
  (add-hook 'shell-mode-hook 'ansi-color-for-comint-mode-on)
  (add-to-list 'comint-output-filter-functions 'ansi-color-process-output)
  (autoload 'ansi-color-for-comint-mode-on "ansi-color" nil t)
#+end_src

#+begin_src emacs-lisp
(setq ac-modes (delq 'python-mode ac-modes))
#+end_src

** Flycheck
#+begin_src emacs-lisp
 (when (require 'flycheck nil t)
   (setq elpy-modules (delq 'elpy-module-flymake elpy-modules))
   (add-hook 'elpy-mode-hook 'flycheck-mode))
#+end_src

Use aspell to fix my mistakes
#+begin_src emacs-lisp
(setq flyspell-issue-welcome-flag nil)
(if (eq system-type 'darwin)
    (setq-default ispell-program-name "/usr/local/bin/aspell")
  (setq-default ispell-program-name "/usr/bin/aspell"))
(setq-default ispell-list-command "list")

#+end_src

*** Dictionary Definitions: 
Get the definition of the word at point from wiktionary
#+begin_src emacs-lisp
  (autoload 'ispell-get-word "ispell")

  (defun lookup-word (word)
    (interactive (list (save-excursion (car (ispell-get-word nil)))))
    (message "Looking up meaning of %s" word)
    (my/define-word word)
    )
#+end_src

If the underlying api stops working Use =(browse-web (format "https://api.dictionaryapi.dev/api/v1/entries/en/%s" word))= instead

#+begin_src emacs-lisp
  (defun my/define-word (word) 
    (kill-buffer (get-buffer-create "*define-word*"))
    (with-current-buffer (get-buffer-create "*define-word*")
      (erase-buffer)
      (insert (concat "Word: " word "\n\n")))
    (request
      (format "http://wordnik.com/words/%s" word)
      :parser  'define-word--parse-wordnik
      :success
      (cl-function (lambda (&key data &allow-other-keys)
                     (when data
                       (with-current-buffer (get-buffer-create "*define-word*")
                         (insert data)
                         (local-set-key (kbd "q") 'my/kill-this-buffer)
                         (read-only-mode 1)
                         (pop-to-buffer (current-buffer))))))
      :error
      (cl-function (lambda (&key error-thrown &allow-other-keys&rest _)
                     (message "Got error: %S" error-thrown)))
      :complete (lambda (&rest _) (message "Finished!"))
      :status-code '((400 . (lambda (&rest _) (message "Got 400.")))
                     (418 . (lambda (&rest _) (message "Got 418."))))))
#+end_src

** Markdown
#+begin_src emacs-lisp
(add-to-list 'auto-mode-alist '("\\.md$" . markdown-mode))
(add-to-list 'auto-mode-alist '("\\.mdown$" . markdown-mode))
(add-hook 'markdown-mode-hook
          (lambda ()
            (visual-line-mode t)
            (writegood-mode t)
            (flyspell-mode t)))

#+end_src

** Org
#+begin_src emacs-lisp
  (add-to-list 'auto-mode-alist '("^\\*.org\\*$" . org-mode))
  (add-to-list 'auto-mode-alist '("\\.org\\'" . org-mode))

  (add-hook 'org-mode-hook 'org-indent-mode)
  (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1)))
  (add-hook 'org-mode-hook 'flyspell-mode)
  (add-hook 'org-mode-hook 'writegood-mode)
  (when (system-is-laptop)
    (add-hook 'org-mode-hook 'org-password-manager-key-bindings))
  (add-hook 'org-mode-hook 'org-beamer-mode)
  (add-hook 'org-mode-hook 'org-bullets-mode)
  (add-hook 'org-mode-hook
            (lambda ()
              (let ((filename (buffer-file-name (current-buffer))))
                (if (and filename (member (file-name-extension filename) sensitive-extensions))
                    (sensitive-mode) (sensitive-mode -1)))))
#+end_src

#+RESULTS:
: ((^\*.org.gpg\' global-undo-tree-mode nil) (^\*.org.gpg\' undo-tree-mode -1) (^\*.org.gpg\' undo-tree-mode nil) (\.[pP][dD][fF]\' . pdf-view-mode) (\.ps\' . doc-view-mode) (\.n3 . ttl-mode) (\.ttl . ttl-mode) (^\*.org\*$ . org-mode) (\.mdown$ . markdown-mode) (\.md$ . markdown-mode) (\.jsx\' . web-mode) (\.js\' . js2-mode) (\.epub\' . nov-mode) (\.s\(cala\|bt\)$ . scala-mode) (\.odc\' . archive-mode) (\.odf\' . archive-mode) (\.odi\' . archive-mode) (\.otp\' . archive-mode) (\.odp\' . archive-mode) (\.otg\' . archive-mode) (\.odg\' . archive-mode) (\.ots\' . archive-mode) (\.ods\' . archive-mode) (\.odm\' . archive-mode) (\.ott\' . archive-mode) (\.odt\' . archive-mode) (\(?:\(?:\.\(?:b\(?:\(?:abel\|ower\)rc\)\|json\(?:ld\)?\)\|composer\.lock\)\'\) . json-mode) (\.gpg\(~\|\.~[0-9]+~\)?\' nil epa-file) (\(?:build\|profile\)\.boot\' . clojure-mode) (\.cljs\' . clojurescript-mode) (\.cljc\' . clojurec-mode) (\.\(clj\|cljd\|dtm\|edn\)\' . clojure-mode) (\.cmake\' . cmake-mode) (CMakeLists\.txt\' . cmake-mode) (docker-compose[^/]*\.ya?ml\' . docker-compose-mode) (\.dockerfile\' . dockerfile-mode) ([/\]\(?:Containerfile\|Dockerfile\)\(?:\.[^/\]*\)?\' . dockerfile-mode) (\.ipynb\' . ein:ipynb-mode) (mix\.lock . elixir-mode) (\.exs\' . elixir-mode) (\.ex\' . elixir-mode) (\.elixir\' . elixir-mode) (/git-rebase-todo\' . git-rebase-mode) (\.\(?:md\|markdown\|mkd\|mdown\|mkdn\|mdwn\)\' . markdown-mode) (\.[Ss][Aa][Ss]\' . SAS-mode) (\.Sout\' . S-transcript-mode) (\.[Ss]t\' . S-transcript-mode) (\.Rd\' . Rd-mode) (DESCRIPTION\' . conf-colon-mode) (/Makevars\(\.win\)?\' . makefile-mode) (\.[Rr]out\' . ess-r-transcript-mode) (CITATION\' . ess-r-mode) (NAMESPACE\' . ess-r-mode) (\.[rR]profile\' . ess-r-mode) (\.[rR]\' . ess-r-mode) (/R/.*\.q\' . ess-r-mode) (\.[Jj][Aa][Gg]\' . ess-jags-mode) (\.[Bb][Mm][Dd]\' . ess-bugs-mode) (\.[Bb][Oo][Gg]\' . ess-bugs-mode) (\.[Bb][Uu][Gg]\' . ess-bugs-mode) (\.tlc\' . tlc-mode) (\.rs\' . rust-mode) (\.\(scala\|sbt\|worksheet\.sc\)\' . scala-mode) (\.tsx?\' . typescript-mode) (\.\(e?ya?\|ra\)ml\' . yaml-mode) (\.elc\' . elisp-byte-code-mode) (\.zst\' nil jka-compr) (\.dz\' nil jka-compr) (\.xz\' nil jka-compr) (\.lzma\' nil jka-compr) (\.lz\' nil jka-compr) (\.g?z\' nil jka-compr) (\.bz2\' nil jka-compr) (\.Z\' nil jka-compr) (\.vr[hi]?\' . vera-mode) (\(?:\.\(?:rbw?\|ru\|rake\|thor\|jbuilder\|rabl\|gemspec\|podspec\)\|/\(?:Gem\|Rake\|Cap\|Thor\|Puppet\|Berks\|Vagrant\|Guard\|Pod\)file\)\' . ruby-mode) (\.re?st\' . rst-mode) (\.py[iw]?\' . python-mode) (\.m\' . octave-maybe-mode) (\.less\' . less-css-mode) (\.scss\' . scss-mode) (\.awk\' . awk-mode) (\.\(u?lpc\|pike\|pmod\(\.in\)?\)\' . pike-mode) (\.idl\' . idl-mode) (\.java\' . java-mode) (\.m\' . objc-mode) (\.ii\' . c++-mode) (\.i\' . c-mode) (\.lex\' . c-mode) (\.y\(acc\)?\' . c-mode) (\.h\' . c-or-c++-mode) (\.c\' . c-mode) (\.\(CC?\|HH?\)\' . c++-mode) (\.[ch]\(pp\|xx\|\+\+\)\' . c++-mode) (\.\(cc\|hh\)\' . c++-mode) (\.\(bat\|cmd\)\' . bat-mode) (\.[sx]?html?\(\.[a-zA-Z_]+\)?\' . mhtml-mode) (\.svgz?\' . image-mode) (\.svgz?\' . xml-mode) (\.x[bp]m\' . image-mode) (\.x[bp]m\' . c-mode) (\.p[bpgn]m\' . image-mode) (\.tiff?\' . image-mode) (\.gif\' . image-mode) (\.png\' . image-mode) (\.jpe?g\' . image-mode) (\.te?xt\' . text-mode) (\.[tT]e[xX]\' . tex-mode) (\.ins\' . tex-mode) (\.ltx\' . latex-mode) (\.dtx\' . doctex-mode) (\.org\' . org-mode) (\.el\' . emacs-lisp-mode) (Project\.ede\' . emacs-lisp-mode) (\.\(scm\|stk\|ss\|sch\)\' . scheme-mode) (\.l\' . lisp-mode) (\.li?sp\' . lisp-mode) (\.[fF]\' . fortran-mode) (\.for\' . fortran-mode) (\.p\' . pascal-mode) (\.pas\' . pascal-mode) (\.\(dpr\|DPR\)\' . delphi-mode) (\.ad[abs]\' . ada-mode) (\.ad[bs]\.dg\' . ada-mode) (\.\([pP]\([Llm]\|erl\|od\)\|al\)\' . perl-mode) (Imakefile\' . makefile-imake-mode) (Makeppfile\(?:\.mk\)?\' . makefile-makepp-mode) (\.makepp\' . makefile-makepp-mode) (\.mk\' . makefile-bsdmake-mode) (\.make\' . makefile-bsdmake-mode) (GNUmakefile\' . makefile-gmake-mode) ([Mm]akefile\' . makefile-bsdmake-mode) (\.am\' . makefile-automake-mode) (\.texinfo\' . texinfo-mode) (\.te?xi\' . texinfo-mode) (\.[sS]\' . asm-mode) (\.asm\' . asm-mode) (\.css\' . css-mode) (\.mixal\' . mixal-mode) (\.gcov\' . compilation-mode) (/\.[a-z0-9-]*gdbinit . gdb-script-mode) (-gdb\.gdb . gdb-script-mode) ([cC]hange\.?[lL]og?\' . change-log-mode) ([cC]hange[lL]og[-.][0-9]+\' . change-log-mode) (\$CHANGE_LOG\$\.TXT . change-log-mode) (\.scm\.[0-9]*\' . scheme-mode) (\.[ckz]?sh\'\|\.shar\'\|/\.z?profile\' . sh-mode) (\.bash\' . sh-mode) (\(/\|\`\)\.\(bash_\(profile\|history\|log\(in\|out\)\)\|z?log\(in\|out\)\)\' . sh-mode) (\(/\|\`\)\.\(shrc\|zshrc\|m?kshrc\|bashrc\|t?cshrc\|esrc\)\' . sh-mode) (\(/\|\`\)\.\([kz]shenv\|xinitrc\|startxrc\|xsession\)\' . sh-mode) (\.m?spec\' . sh-mode) (\.m[mes]\' . nroff-mode) (\.man\' . nroff-mode) (\.sty\' . latex-mode) (\.cl[so]\' . latex-mode) (\.bbl\' . latex-mode) (\.bib\' . bibtex-mode) (\.bst\' . bibtex-style-mode) (\.sql\' . sql-mode) (\(acinclude\|aclocal\|acsite\)\.m4\' . autoconf-mode) (\.m[4c]\' . m4-mode) (\.mf\' . metafont-mode) (\.mp\' . metapost-mode) (\.vhdl?\' . vhdl-mode) (\.article\' . text-mode) (\.letter\' . text-mode) (\.i?tcl\' . tcl-mode) (\.exp\' . tcl-mode) (\.itk\' . tcl-mode) (\.icn\' . icon-mode) (\.sim\' . simula-mode) (\.mss\' . scribe-mode) (\.f9[05]\' . f90-mode) (\.f0[38]\' . f90-mode) (\.indent\.pro\' . fundamental-mode) (\.\(pro\|PRO\)\' . idlwave-mode) (\.srt\' . srecode-template-mode) (\.prolog\' . prolog-mode) (\.tar\' . tar-mode) (\.\(arc\|zip\|lzh\|lha\|zoo\|[jew]ar\|xpi\|rar\|cbr\|7z\|ARC\|ZIP\|LZH\|LHA\|ZOO\|[JEW]AR\|XPI\|RAR\|CBR\|7Z\)\' . archive-mode) (\.oxt\' . archive-mode) (\.\(deb\|[oi]pk\)\' . archive-mode) (\`/tmp/Re . text-mode) (/Message[0-9]*\' . text-mode) (\`/tmp/fol/ . text-mode) (\.oak\' . scheme-mode) (\.sgml?\' . sgml-mode) (\.x[ms]l\' . xml-mode) (\.dbk\' . xml-mode) (\.dtd\' . sgml-mode) (\.ds\(ss\)?l\' . dsssl-mode) (\.js[mx]?\' . javascript-mode) (\.har\' . javascript-mode) (\.json\' . javascript-mode) (\.[ds]?va?h?\' . verilog-mode) (\.by\' . bovine-grammar-mode) (\.wy\' . wisent-grammar-mode) ([:/\]\..*\(emacs\|gnus\|viper\)\' . emacs-lisp-mode) (\`\..*emacs\' . emacs-lisp-mode) ([:/]_emacs\' . emacs-lisp-mode) (/crontab\.X*[0-9]+\' . shell-script-mode) (\.ml\' . lisp-mode) (\.ld[si]?\' . ld-script-mode) (ld\.?script\' . ld-script-mode) (\.xs\' . c-mode) (\.x[abdsru]?[cnw]?\' . ld-script-mode) (\.zone\' . dns-mode) (\.soa\' . dns-mode) (\.asd\' . lisp-mode) (\.\(asn\|mib\|smi\)\' . snmp-mode) (\.\(as\|mi\|sm\)2\' . snmpv2-mode) (\.\(diffs?\|patch\|rej\)\' . diff-mode) (\.\(dif\|pat\)\' . diff-mode) (\.[eE]?[pP][sS]\' . ps-mode) (\.\(?:PDF\|DVI\|OD[FGPST]\|DOCX\|XLSX?\|PPTX?\|pdf\|djvu\|dvi\|od[fgpst]\|docx\|xlsx?\|pptx?\)\' . doc-view-mode-maybe) (configure\.\(ac\|in\)\' . autoconf-mode) (\.s\(v\|iv\|ieve\)\' . sieve-mode) (BROWSE\' . ebrowse-tree-mode) (\.ebrowse\' . ebrowse-tree-mode) (#\*mail\* . mail-mode) (\.g\' . antlr-mode) (\.mod\' . m2-mode) (\.ses\' . ses-mode) (\.docbook\' . sgml-mode) (\.com\' . dcl-mode) (/config\.\(?:bat\|log\)\' . fundamental-mode) (/\.\(authinfo\|netrc\)\' . authinfo-mode) (\.\(?:[iI][nN][iI]\|[lL][sS][tT]\|[rR][eE][gG]\|[sS][yY][sS]\)\' . conf-mode) (\.la\' . conf-unix-mode) (\.ppd\' . conf-ppd-mode) (java.+\.conf\' . conf-javaprop-mode) (\.properties\(?:\.[a-zA-Z0-9._-]+\)?\' . conf-javaprop-mode) (\.toml\' . conf-toml-mode) (\.desktop\' . conf-desktop-mode) (/\.redshift\.conf\' . conf-windows-mode) (\`/etc/\(?:DIR_COLORS\|ethers\|.?fstab\|.*hosts\|lesskey\|login\.?de\(?:fs\|vperm\)\|magic\|mtab\|pam\.d/.*\|permissions\(?:\.d/.+\)?\|protocols\|rpc\|services\)\' . conf-space-mode) (\`/etc/\(?:acpid?/.+\|aliases\(?:\.d/.+\)?\|default/.+\|group-?\|hosts\..+\|inittab\|ksysguarddrc\|opera6rc\|passwd-?\|shadow-?\|sysconfig/.+\)\' . conf-mode) ([cC]hange[lL]og[-.][-0-9a-z]+\' . change-log-mode) (/\.?\(?:gitconfig\|gnokiirc\|hgrc\|kde.*rc\|mime\.types\|wgetrc\)\' . conf-mode) (/\.\(?:asound\|enigma\|fetchmail\|gltron\|gtk\|hxplayer\|mairix\|mbsync\|msmtp\|net\|neverball\|nvidia-settings-\|offlineimap\|qt/.+\|realplayer\|reportbug\|rtorrent\.\|screen\|scummvm\|sversion\|sylpheed/.+\|xmp\)rc\' . conf-mode) (/\.\(?:gdbtkinit\|grip\|mpdconf\|notmuch-config\|orbital/.+txt\|rhosts\|tuxracer/options\)\' . conf-mode) (/\.?X\(?:default\|resource\|re\)s\> . conf-xdefaults-mode) (/X11.+app-defaults/\|\.ad\' . conf-xdefaults-mode) (/X11.+locale/.+/Compose\' . conf-colon-mode) (/X11.+locale/compose\.dir\' . conf-javaprop-mode) (\.~?[0-9]+\.[0-9][-.0-9]*~?\' nil t) (\.\(?:orig\|in\|[bB][aA][kK]\)\' nil t) ([/.]c\(?:on\)?f\(?:i?g\)?\(?:\.[a-zA-Z0-9._-]+\)?\' . conf-mode-maybe) (\.[1-9]\' . nroff-mode) (\.art\' . image-mode) (\.avs\' . image-mode) (\.bmp\' . image-mode) (\.cmyk\' . image-mode) (\.cmyka\' . image-mode) (\.crw\' . image-mode) (\.dcr\' . image-mode) (\.dcx\' . image-mode) (\.dng\' . image-mode) (\.dpx\' . image-mode) (\.fax\' . image-mode) (\.hrz\' . image-mode) (\.icb\' . image-mode) (\.icc\' . image-mode) (\.icm\' . image-mode) (\.ico\' . image-mode) (\.icon\' . image-mode) (\.jbg\' . image-mode) (\.jbig\' . image-mode) (\.jng\' . image-mode) (\.jnx\' . image-mode) (\.miff\' . image-mode) (\.mng\' . image-mode) (\.mvg\' . image-mode) (\.otb\' . image-mode) (\.p7\' . image-mode) (\.pcx\' . image-mode) (\.pdb\' . image-mode) (\.pfa\' . image-mode) (\.pfb\' . image-mode) (\.picon\' . image-mode) (\.pict\' . image-mode) (\.rgb\' . image-mode) (\.rgba\' . image-mode) (\.tga\' . image-mode) (\.wbmp\' . image-mode) (\.webp\' . image-mode) (\.wmf\' . image-mode) (\.wpg\' . image-mode) (\.xcf\' . image-mode) (\.xmp\' . image-mode) (\.xwd\' . image-mode) (\.yuv\' . image-mode) (\.tgz\' . tar-mode) (\.tbz2?\' . tar-mode) (\.txz\' . tar-mode) (\.tzst\' . tar-mode))

** Dumb Jump
Dumb jump lets me goto definitions easily using a dumb =ag= search
#+begin_src emacs-lisp
(dumb-jump-mode 1)
(setq dumb-jump-selector 'helm)
(setq dumb-jump-force-searcher 'ag)
#+end_src

** Ontology
*** Turtle Format
Enable bindings for turtle format
#+begin_src emacs-lisp
(autoload 'ttl-mode "ttl-mode" "Major mode for OWL or Turtle files" t)
(add-hook 'ttl-mode-hook    ; Turn on font lock when in ttl mode
          'turn-on-font-lock)
(setq auto-mode-alist
      (append
       (list
        '("\\.n3" . ttl-mode)
        '("\\.ttl" . ttl-mode))
       auto-mode-alist))
#+end_src

* Org
** Global
Time tracking on tasks
#+begin_src emacs-lisp
  (require 'org-inlinetask)
  (setq org-clock-persist 'history)
  (setq org-startup-folded t)
  (org-clock-persistence-insinuate)
  (setq org-log-into-drawer t)
#+end_src

Image Scaling 
#+begin_src emacs-lisp
(setq org-image-actual-width nil)
#+end_src

Allow alphabets ‘a.’, ‘A.’, ‘a)’ and ‘A) as list elements:
#+begin_src emacs-lisp
(setq org-list-allow-alphabetical t)
#+end_src

Allow helm completion for tags
#+begin_src emacs-lisp
(add-hook 'org-mode-hook
            (lambda () (add-to-list 'helm-completing-read-handlers-alist '(org-set-tags-command))))

#+end_src

Org-bullet customization
#+begin_src emacs-lisp
(setq org-bullets-bullet-list '("◉" "◎" "○" "►" "*"))
#+end_src

Default keep pretty entities
#+begin_src emacs-lisp
(setq org-pretty-entities t)
#+end_src

Prettify list bullets
#+begin_src emacs-lisp
  (font-lock-add-keywords
   'org-mode
   '(("^ *\\([-]\\) "
      (0 (prog1 () (compose-region (match-beginning 1) (match-end 1) "•"))))))
#+end_src


Org ordered dependencies 
#+begin_src emacs-lisp
(setq-default org-enforce-todo-dependencies t)
#+end_src

Themes, look and feel
#+begin_src emacs-lisp
  (setq org-hide-emphasis-markers t)

  ;; Font
  (custom-theme-set-faces 'user `(org-document-title ((t (:foreground "#3282b8" :height 1.3 :underline nil)))))

  (setq org-priority-faces '((?A . (:foreground "#F0DFAF" :weight bold))
                             (?B . (:foreground "LightSteelBlue"))
                             (?C . (:foreground "OliveDrab"))))



  (dolist (face '((org-level-1 . 1.1)
                  (org-level-2 . 1.05)
                  (org-level-3 . 1.02)
                  (org-level-4 . 1.0)
                  (org-level-5 . 1.0)
                  (org-level-6 . 1.0)
                  (org-level-7 . 1.0)
                  (org-level-8 . 1.0)))
    (set-face-attribute (car face) nil :weight 'medium :height (cdr face)))
#+end_src

Wrap region for word formatting
#+begin_src emacs-lisp
(wrap-region-add-wrappers
   '(("*" "*" nil org-mode)
     ("~" "~" nil org-mode)
     ("/" "/" nil org-mode)
     ("=" "=" "+" org-mode)
     ("_" "_" nil org-mode)
     ("`" "`" nil prog-mode)
     ("$" "$" nil (org-mode latex-mode))))
#+end_src

Open org links in the same window
#+begin_src emacs-lisp
(setf (cdr (assoc 'file org-link-frame-setup)) 'find-file)
#+end_src

** Exo-cortex
A place to store and remember everything that I can't burden my brain with thinking about. 
*** File Organization
- Journal/Micro plan :: Used to plan the day. Journal captures the day's schedule, meetings and work task
#+begin_src emacs-lisp
(setq journal-file-path "~/Documents/org-notes/Dropbox/org-notes/today.org")
#+end_src

- Capture :: All unscheduled sudden surges of things which I remember get captured into this file. Mostly things here are without a schedule or deadline, which need to refiling and revisiting sometime in the future. Also serves as the Bookmark collection of websites, videos, books, courses and podcasts. 
#+begin_src emacs-lisp
(setq capture-file-path "~/Documents/org-notes/Dropbox/org-notes/capture.org")
(setq org-default-notes-file capture-file-path)
#+end_src

- Inbox :: All the scheduled tasks go into this file. If something gets scheduled from the capture file, they move into inbox. 
#+begin_src emacs-lisp
(setq tasks-file-path "~/Documents/org-notes/Dropbox/org-notes/inbox.org")
#+end_src

- Home Tasks :: Its better to keep work and home separate. So a separate home task file
#+begin_src emacs-lisp
(setq home-tasks-file-path "~/Documents/org-notes/Dropbox/org-notes/home/tasks.org")
#+end_src

- References :: All the papers which need to be read, are captured into references.bib, whose offshot gets captured in references. They get planned and scheduled, and at max may be a part of a project. The section in references only moves to Projects, and never to Inbox.
#+begin_src emacs-lisp
(setq references-file-path "~/Documents/org-notes/slipbox/bibliography/references.org")
#+end_src

- Personal Library :: A collection of novels - fictional and non fictional to read. Its always good to have a habit for reading

#+begin_src emacs-lisp
(setq personal-library-file-path "~/Documents/org-notes/slipbox/reading-list/library.org")
#+end_src

- Projects :: This makes sure that everything I start gets done. Things move from capture into projects, gets scheduled and mostly has notes and sub items - scheduled or unscheduled. Nothing gets added to projects without having lived in capture
#+begin_src emacs-lisp
(setq projects-file-path "~/Documents/org-notes/Dropbox/org-notes/projects.org")
#+end_src

**** ORG-Agenda: 
All the above mentioned files just form a part of the bigger agenda.
#+begin_src emacs-lisp
  (when (system-is-laptop)
    (setq org-agenda-files
          (list tasks-file-path
                projects-file-path
                capture-file-path
                journal-file-path
                references-file-path
                personal-library-file-path
                home-tasks-file-path
                "~/Documents/org-notes/Dropbox/org-notes/daily.org")))
  
  (when (system-is-workstation)
    (setq org-agenda-files
          (list tasks-file-path
                projects-file-path
                capture-file-path
                journal-file-path
                home-tasks-file-path
                "~/Documents/org-notes/Dropbox/org-notes/daily.org")))
#+end_src

*** Org TODO cycles

After multiple iterations of the TODO cycles, finally decided on using a simple list of TODOS, and to rely more on tags to mark the kind of TODO

- TODO :: Anything that needs to be done. Mostly without a schedule or a deadline or with an arbitrary future schedule, but must be picked up on priority
- SCHEDULED :: Things move from TODO to SCHEDULED, when a schedule or a deadline is attached to them and it has been slotted to be picked up.
- INPROGRESS :: Currently in play
- HOLD :: Things which had been picked up but have been put on hold due to
  1. Further updates or conflicting requirement with some other task
  2. Is waiting on a feedback from a second person
- DONE :: Finished, and ready to be archived.
- CANCELLED :: No more important. Ready to be archived.
- RE-VISIT :: Things done, but need a second opinion
- POSTPONED :: Not important at this moment. Can't be archived until DONE or CANCELLED

#+begin_src emacs-lisp
  (setq org-todo-keywords
        '((sequence "TODO(t)" "SCHEDULED(s!)" "HOLD(h!)"  "INPROGRESS(i!)" "|" "DONE(d!)" "CANCELLED(c!)" )
          (sequence "|" "POSTPONED(P!)" "RE-VISIT(v)")
          (sequence "⌛HOLD" "⌚INPROGRESS" "|")))

  (setq org-todo-keyword-faces
        '(("TODO" . (:foreground "#ff39a3" :weight bold))
          ("SCHEDULED" . (:foreground "#81D8D1"  :weight bold))
          ("HOLD" . (:foreground "#ff9a00" :weight bold))
          ("SHELVED" . (:foreground "#ff9a00" :weight bold))
          ("⌛HOLD" . (:foreground "#ff9a00" :weight bold))
          ("INPROGRESS" . (:foreground "#ffdd00" :weight bold))
          ("READING" . (:foreground "#ffdd00" :weight bold))
          ("⌚INPROGRESS" . (:foreground "#ffdd00" :weight bold))
          ("CANCELLED" . (:foreground "white" :background "#4d4d4d" :weight bold))
          ("RE-VISIT" . (:foreground "#88ddee" :background "#454545" :weight bold))
          ("POSTPONED" . "#008080")))
#+end_src

Mark tasks as done if subtasks are done
#+begin_src emacs-lisp
(defun org-summary-todo (n-done n-not-done)
  "Switch entry to DONE when all subentries are done, to TODO otherwise."
  (let (org-log-done org-log-states)   ; turn off logging
    (org-todo (if (= n-not-done 0) "DONE" "TODO"))))

(add-hook 'org-after-todo-statistics-hook 'org-summary-todo)
#+end_src

** PDF view
Install PDF tools 
#+begin_src emacs-lisp
(pdf-tools-install)
#+end_src

Always open PDF inside EMACS itself
#+begin_src emacs-lisp

(add-to-list 'org-file-apps 
             '("\\.pdf\\'" . emacs))
(add-to-list 'auto-mode-alist '("\\.ps\\'" . doc-view-mode))
#+end_src

Fine grained zoom with + and - to 10% 
#+begin_src emacs-lisp
(setq pdf-view-resize-factor 1.1)
#+end_src

Dark Mode always
#+begin_src emacs-lisp
  (add-hook 'pdf-tools-enabled-hook 'pdf-view-midnight-minor-mode)
  (setq-default pdf-view-display-size 'fit-width)
  (setq pdf-view-midnight-colors '("#AAAA99" . "#282828"))
  (setq-default pdf-view-display-size 'fit-page)
#+end_src

#+RESULTS:
: fit-page

Remember the last read page
#+begin_src emacs-lisp
(add-hook 'pdf-view-mode-hook 'pdf-view-restore-mode)
(setq pdf-view-restore-filename "~/.emacs.d/.pdf-view-restore")
#+end_src

Fix evil conflict with pdf-tool
#+begin_src example
(evil-set-initial-state 'pdf-view-mode 'emacs)
(add-hook 'pdf-view-mode-hook
  (lambda ()
    (set (make-local-variable 'evil-emacs-state-cursor) (list nil))))
#+end_src

** Org-agenda
Get a view of month ahead instead of the default 2 weeks.
#+begin_src emacs-lisp
(setq-default org-deadline-warning-days 30)
(setq-default org-habit-graph-column 80)
#+end_src

Org-super-agenda
#+begin_src emacs-lisp
  (defun get-fortnight-date ()
    (let* ((now (decode-time))
           (fortnight (copy-sequence now)))
    (cl-incf (nth 3 fortnight) 14)
    (format-time-string "%Y-%m-%d" (apply #'encode-time fortnight))))
    (setq org-agenda-prefix-format '((agenda . " %i %-12:c%?-12t%-6e% s")
                                (todo . " %i %-12:c %-6e")
                                (tags . " %i %-12:c")
                                (search . " %i %-12:c")))
  (let (target-date (get-fortnight-date))
  (setq org-agenda-time-grid '((daily today require-timed)
   (800 1000 1200 1400 1600 1800 2000)
   "......" "----------------")
          org-agenda-skip-scheduled-if-done t
          org-agenda-skip-deadline-if-done t
          org-agenda-include-deadlines t
          org-agenda-include-diary nil
          org-agenda-use-time-grid t
          org-agenda-block-separator nil
          org-agenda-compact-blocks t
          org-agenda-start-with-log-mode t)

      (setq org-super-agenda-groups
             '((:log t)
               (:name "Schedule"
                      :time-grid t)
               (:name "Project Schedule "
                      :tag "@schedule")
               (:name "Today "
                      :scheduled today)
               (:name "Due Today"
                      :deadline today)
               (:name "Habit Tracker "
                      :habit t)
               (:name "Papers"
                      :tag "@article")
               (:name "Books"
                      :tag "@book")
               (:name "Courses"
                      :tag "@course")
               (:name "Birthdays & Anniversaries"
                      :tag ("@anniversary" "@birthday")
                      :order 98)
               (:name "Overdue"
                      :deadline past)
               (:name "Bills and Payments"
                      :tag "@bills_and_payments")
               (:name "Important"
                      :priority ("A" "B"))
               (:name "Inprogress"
                      :todo "INPROGRESS")
               (:name "Due soon"
                      :deadline future)
               (:name "On Hold"
                      :todo "HOLD"
                      :order 7)
               (:name "Shopping List"
                      :tag "@shopping_list")
               (:name "Scheduled earlier"
                      :scheduled past))))

#+end_src

#+RESULTS:
| :log  | t                         |            |                          |        |    |
| :name | Schedule                  | :time-grid | t                        |        |    |
| :name | Project Schedule          | :tag       | @schedule                |        |    |
| :name | Today                     | :scheduled | today                    |        |    |
| :name | Due Today                 | :deadline  | today                    |        |    |
| :name | Habit Tracker             | :habit     | t                        |        |    |
| :name | Papers                    | :tag       | @article                 |        |    |
| :name | Books                     | :tag       | @book                    |        |    |
| :name | Courses                   | :tag       | @course                  |        |    |
| :name | Birthdays & Anniversaries | :tag       | (@anniversary @birthday) | :order | 98 |
| :name | Overdue                   | :deadline  | past                     |        |    |
| :name | Bills and Payments        | :tag       | @bills_and_payments      |        |    |
| :name | Important                 | :priority  | (A B)                    |        |    |
| :name | Inprogress                | :todo      | INPROGRESS               |        |    |
| :name | Due soon                  | :deadline  | future                   |        |    |
| :name | On Hold                   | :todo      | HOLD                     | :order |  7 |
| :name | Shopping List             | :tag       | @shopping_list           |        |    |
| :name | Scheduled earlier         | :scheduled | past                     |        |    |

Display TODO list in a formatted manner
#+begin_src emacs-lisp
  (add-to-list 'org-agenda-custom-commands
               '("t" "All TODOs groups by category" alltodo ""
                 ((org-super-agenda-groups '((:auto-category t))))))
  (add-to-list 'org-agenda-custom-commands
               '("p" "Projects" tags-todo "@inbox|@projects"
                 ((org-super-agenda-groups '((:auto-category t))))))
  (add-to-list 'org-agenda-custom-commands
               '("c" "Captured Tasks" tags-todo "@tasks|@second_brain"
                 ((org-super-agenda-groups '((:auto-category t))))))
  (add-to-list 'org-agenda-custom-commands
               '("r" "Reading" tags-todo "@library|@reference"
                 ((org-super-agenda-groups '((:auto-category t))))))
  (add-to-list 'org-agenda-custom-commands
               '("l" "Local" tags-todo "@local"
                 ((org-super-agenda-groups '((:auto-category t))))))

#+end_src


#+begin_src emacs-lisp
  (require 'org-agenda)
  (setq org-agenda-prefix-format '(
   (agenda  . " %i  %-12:c%?-12t% s") ;; file name + org-agenda-entry-type
    ;;(agenda  . "%-12c%?-12t% s")
    (timeline . " % s")
    (todo  . " %?-12:c")
    (tags  . " %i %-12:c")
    (search . " %i %-12:c")))
#+end_src

Disable visual line mode in agenda view as it wraps the tags to new line
#+begin_src emacs-lisp
(add-hook 'org-agenda-mode-hook
          (lambda ()
            (visual-line-mode 1)
            (toggle-truncate-lines 1)))
#+end_src

Display agenda in a full window view instead of a frame view
#+begin_src emacs-lisp
(setq-default org-agenda-window-setup 'only-window)
#+end_src

** Org-clock

Idle Time
#+begin_src emacs-lisp
(setq org-clock-idle-time 15)
#+end_src

Log on close
#+begin_src emacs-lisp
(setq org-log-done 'time)
#+end_src
Use ~C-c C-c C-i~ to clock in. This is to support an independent flow of ~INPROGRESS~ without clocking.
Automatically pause the clock when the task moves to ~HOLD~ from ~⌚INPROGRESS~
#+begin_src emacs-lisp
  (defun my/org-clock-in-if-inprogress ()
    "Pause the clock when task goes into HOLD mode."
    (when (and (string= org-state "HOLD")
               (string= org-last-state "⌚INPROGRESS"))
      (org-clock-out)))

  (add-hook 'org-after-todo-state-change-hook
            'my/org-clock-in-if-inprogress)
#+end_src

Custom
#+begin_src emacs-lisp
  (setq-default org-clock-clocktable-default-properties
                '(:block day :maxlevel 3 :scope agenda :link t :compact t :formula %
                         :step day :fileskip0 t :stepskip0 t :narrow 80
                         :properties ("CLOCKSUM" "CLOCKSUM_T" "TODO"))
                org-clock-in-switch-to-state "⌚INPROGRESS"
                org-clock-out-switch-to-state "⌛HOLD"
                org-clock-continuously nil
                org-clock-persist-query-resume nil
                org-clock-out-remove-zero-time-clocks t
                org-clock-report-include-clocking-task t)
#+end_src

*** TODO Deadlines based on Effort estimation
#+begin_src emacs-lisp
(defun org-schedule-effort ()
(interactive)
  (save-excursion
    (org-back-to-heading t)
    (let* (
        (element (org-element-at-point))
        (effort (org-element-property :Effort element))
        (scheduled (org-element-property :scheduled element))
        (ts-year-start (org-element-property :year-start scheduled))
        (ts-month-start (org-element-property :month-start scheduled))
        (ts-day-start (org-element-property :day-start scheduled))
        (ts-hour-start (org-element-property :hour-start scheduled))
        (ts-minute-start (org-element-property :minute-start scheduled)) )
      (org-schedule nil (concat
        (format "%s" ts-year-start)
        "-"
        (if (< ts-month-start 10)
          (concat "0" (format "%s" ts-month-start))
          (format "%s" ts-month-start))
        "-"
        (if (< ts-day-start 10)
          (concat "0" (format "%s" ts-day-start))
          (format "%s" ts-day-start))
        " "
        (if (< ts-hour-start 10)
          (concat "0" (format "%s" ts-hour-start))
          (format "%s" ts-hour-start))
        ":"
        (if (< ts-minute-start 10)
          (concat "0" (format "%s" ts-minute-start))
          (format "%s" ts-minute-start))
        "+"
        effort)) )))

#+end_src

#+RESULTS:
: org-schedule-effort

** Files
List of global org files
#+begin_src emacs-lisp
(setq org-directory "~/Documents/org-notes")
(setq secrets-file-path "~/Documents/Personal/secrets.org.gpg")
(setq secrets-file (cons 'file secrets-file-path))
(set-register ?s secrets-file)
(set-register ?r (cons 'file references-file-path))
(set-register ?p (cons 'file projects-file-path))
(set-register ?b (cons 'file capture-file-path))
(set-register ?h (cons 'file home-tasks-file-path))
(set-register ?t (cons 'file journal-file-path))



(setq org-agenda-file-regexp "\\`[^.].*\\.org'\\|[0-9]+$")
(add-hook 'diary-display-hook 'diary-fancy-display)

(setq org-refile-targets '((projects-file-path :maxlevel . 3)
                           (home-tasks-file-path :maxlevel . 2)
                           (references-file-path :maxlevel . 2)
                           (tasks-file-path :level . 1)
                           (capture-file-path :maxlevel . 3)))


#+end_src

** Org Babel
#+begin_src emacs-lisp
  (org-babel-do-load-languages
   'org-babel-load-languages
   '(
     (python . t)
     (R . t)
     (prolog . t)
     (lisp . t)
     (shell . t)
     (elixir . t)
     (ein . t)))

  (defun my-org-confirm-babel-evaluate (lang body)
    (not (member lang '("python" "lisp" "emacs-lisp" "clojure" "prolog" "sh" "R" "elixir"))))

  (setq org-confirm-babel-evaluate 'my-org-confirm-babel-evaluate)

#+end_src

#+RESULTS:
: my-org-confirm-babel-evaluate

** Org latex
Add LATEX to path: Only present in the laptop
#+begin_src emacs-lisp
(when (system-is-laptop)
#+end_src
#+begin_src emacs-lisp
(setenv "PATH" (concat (getenv "PATH") ":/Library/TeX/texbin/"))
#+end_src
#+begin_example emacs-lisp
  (setq org-latex-pdf-process
        '("latexmk -pdflatex='pdflatex -interaction nonstopmode' -pdf -bibtex -f %f"))
  (add-to-list 'org-latex-default-packages-alist '("" "natbib" "") t)
  (add-to-list 'org-latex-default-packages-alist
               '("linktocpage,pdfstartview=FitH,colorlinks,
  linkcolor=blue,anchorcolor=blue,
  citecolor=blue,filecolor=blue,menucolor=blue,urlcolor=blue"
                 "hyperref" nil)
               t)

  (setq org-latex-prefer-user-labels t)
#+end_example

#+begin_src emacs-lisp
(setq org-latex-pdf-process
      '("pdflatex -interaction nonstopmode -output-directory %o %f"
	"bibtex %b"
	"pdflatex -interaction nonstopmode -output-directory %o %f"
	"pdflatex -interaction nonstopmode -output-directory %o %f"))
(setq bibtex-dialect 'biblatex)
#+end_src

Add to global tex-compile commands
#+begin_src emacs-lisp
(require 'tex-mode) 
(add-to-list 'tex-compile-commands '("latexmk -pdflatex='pdflatex -interaction nonstopmode' -pdf -bibtex -f %f")))
#+end_src

Show latex preview for formula after save
#+begin_src emacs-lisp
(defun my/org-render-latex-fragments ()
      (progn (org-toggle-latex-fragment)
             (org-toggle-latex-fragment))
    (org-toggle-latex-fragment))

(add-hook 'org-mode-hook
          (lambda ()
            (add-hook 'after-save-hook 'my/org-render-latex-fragments nil 'make-the-hook-local)))

(add-hook 'org-mode-hook 'my/org-render-latex-fragments)
#+end_src

Bigger latex fragment

#+begin_src emacs-lisp
(plist-put org-format-latex-options :scale 1.2)
#+end_src




** Org ref
Search through bibtex reference using helm reference
Only defined for laptop
#+begin_src emacs-lisp
  (defun my/helm-bibtex-publications (&optional arg)
    "Search BibTeX entries authored by “Jane Doe”.

  With a prefix ARG, the cache is invalidated and the bibliography reread."
    (interactive "P")
    (ivy-bibtex))

#+end_src 

Update the cite function from the default bibtex-completion 
#+begin_src emacs-lisp
  (defun my/bibtex-completion-format-citation-cite (keys)
    "Format cite references for keys in KEYS."
    (s-join ", "
            (--map (format "cite:%s" it) keys)))

  (setf (alist-get 'org-mode bibtex-completion-format-citation-functions) 'my/bibtex-completion-format-citation-cite)
#+end_src

Manage notes using helm bibtex
#+begin_src emacs-lisp
  ;; Tell org-ref to let helm-bibtex find notes for it
  (setq org-ref-notes-function 'org-ref-notes-function-many-files)
#+end_src

Or Supply a lambda to tell it what to do
#+begin_src emacs-lisp
  ;; (setq org-ref-notes-function (lambda (thekey)
  ;; 	(let ((bibtex-completion-bibliography (org-ref-find-bibliography)))
  ;; 	  (bibtex-completion-edit-notes
  ;; 	   (list (car (org-ref-get-bibtex-key-and-file thekey)))))))
#+end_src


Function to Update bib files when adding new one. 
#+begin_src emacs-lisp
  (defun update-bibfiles () 
    (interactive)
    (let* ((bib-path "~/Documents/org-notes/slipbox/bibliography/" ) (bib-files 
           (mapcar 
            (lambda (x) (concat bib-path x )) 
            (directory-files bib-path nil "bib$"))))

      (setq bibtex-completion-bibliography bib-files
            reftex-default-bibliography bib-files
            org-ref-default-bibliography bib-files)))

#+end_src

Org-ref Files 
#+begin_src emacs-lisp
  (setq org-ref-pdf-directory "~/Documents/org-notes/slipbox/bibliography/bibtex-pdfs/"
        org-ref-notes-directory "~/Documents/org-notes/slipbox/bibliography/helm-bibtex-notes"
        org-ref-notes-function 'org-ref-notes-function-many-files)
  (update-bibfiles)
#+end_src

*** Bibtex

#+begin_src emacs-lisp
  (setq bibtex-completion-library-path "~/Documents/org-notes/slipbox/bibliography/bibtex-pdfs"
        bibtex-completion-notes-path "~/Documents/org-notes/slipbox/bibliography/helm-bibtex-notes"
        bibtex-completion-pdf-field "File"
        bibtex-completion-pdf-symbol "⌘"
        bibtex-completion-notes-symbol "✎"
        bibtex-completion-additional-search-fields '(tags keywords))
  (setq bibtex-completion-display-formats
        '((t . "${author:30} ${title:150} ${year:4} ${=has-pdf=:1}${=has-note=:1} ${=type=:7}")))
#+end_src

Org-ref header format to support PDF interleaving

#+begin_src emacs-lisp
  (setq bibtex-completion-notes-template-multiple-files "#+TITLE: ${title} - ${author-or-editor} (${year})\n#+ROAM_KEY: cite:${=key=}\n\n\n* Notes \n :PROPERTIES: \n :INTERLEAVE_PDF: ../bibtex-pdfs/${=key=}.pdf\n :END:\n")
#+end_src

Add compatibility between interleave and org-noter
#+begin_src emacs-lisp
(setq org-noter-property-doc-file "INTERLEAVE_PDF"
      org-noter-property-note-location "INTERLEAVE_PAGE_NOTE")
#+end_src

Org-noter config
#+begin_src emacs-lisp
  (setq org-noter-always-create-frame nil)
  (setq org-noter-notes-search-path (list bibtex-completion-notes-path "."))
#+end_src

** Org roam
   Only defined for laptop
   #+begin_src emacs-lisp
     (when (system-is-laptop)
   #+end_src
Org-Roam setup to facilitate note taking for the research
#+begin_src emacs-lisp
(setq-default org-roam-directory (concat org-directory "/slipbox"))
(setq org-roam-completion-system 'helm)
(setq org-roam-graph-exclude-matcher '("reference"))
(setq org-roam-index-file (concat org-roam-directory "/README.org"))
#+end_src

#+RESULTS:
: ~/Documents/org-notes/slipbox/README.org

Have a separate Notes folder for captures. Helps in keeping the thoughts clean
#+begin_src emacs-lisp
  (setq-default org-roam-capture-templates
    '(
      ("u" "Unordered Notes" plain
       (function org-roam-capture--get-point)
       :head "#+TITLE: ${title}\n#+ROAM_ALIAS: \"${slug}\"\n\n #tag \n- ref :: %a\n%i\n"
       :file-name "exocortex/unordered/%<%Y%m%d%H%M%S>_${slug}"
       :immediate-finish t
       :jump-to-captured t
       :unnarrowed t)
      ("r" "References Notes" plain
       (function org-roam-capture--get-point)
       :head "#+TITLE: ${title}\n#+FILETAGS: \"REFERENCE\"\n#+ROAM_ALIAS: \"${slug}\"\n%i\n"
       :file-name "references/%<%Y%m%d%H%M%S>_${slug}"
       :immediate-finish t
       :jump-to-captured t
       :unnarrowed t)
      ("p" "Permanant Note" plain
       (function org-roam-capture--get-point)
       "%?" :file-name "exocortex/permanant/%<%Y%m%d%H%M%S>_${slug}"
       :head "#+TITLE: ${title}\n#+ROAM_ALIAS: \"${slug}\"\n #tag \n- Links \n - prev :: %a\n - others :: \n\n\n %i\n"
       :immediate-finish t
       :jump-to-captured t
       :unnarrowed t)
      ("s" "Permanant Sub Note" plain
       (function org-roam-capture--get-point)
       "%?" :file-name "exocortex/permanant/${sub-folder}/%<%Y%m%d%H%M%S>_${slug}"
       :head "#+TITLE: ${title}\n#+ROAM_ALIAS: \"${slug}\"\n #tags \n- Links \n - prev :: %a\n - others :: \n\n\n %i\n"
       :immediate-finish t
       :jump-to-captured t
       :unnarrowed t) 
      ("P" "Project" plain
       (function org-roam-capture--get-point)
       "%?" :file-name "projects/%<%Y%m%d%H%M%S>_${slug}"
       :head "#+TITLE: ${title}\n#+FILETAGS: \"PROJECTS\"\n#+ROAM_ALIAS: \"${slug}\"\n"
       :immediate-finish t
       :jump-to-captured t
       :unnarrowed t)
      ("t" "tags" plain
       (function org-roam-capture--get-point)
       "%?" :file-name "exocortex/tags/%<%Y%m%d%H%M%S>_${slug}"
       :head "#+TITLE: ${title}\n#+FILETAGS: \"TAG\"\n#+ROAM_ALIAS: \"#${slug}\"\n #tags \n\n %i\n"
       :immediate-finish t
       :jump-to-captured t
       :unnarrowed t)
      ))
#+end_src

#+RESULTS:

#+begin_src emacs-lisp
  (defun my/org-roam-insert-tags (&optional lowercase completions filter-fn description)
    "Find an Org-roam file, and insert a relative org link to it at point.
  If LOWERCASE, downcase the title before insertion.
  COMPLETIONS is a list of completions to be used instead of
  `org-roam--get-title-path-completions`.
  FILTER-FN is the name of a function to apply on the candidates
  which takes as its argument an alist of path-completions.
  If DESCRIPTION is provided, use this as the link label.  See
  `org-roam--get-title-path-completions' for details."
    (interactive "P")
    (let* ((region (and (region-active-p)
                        ;; following may lose active region, so save it
                        (cons (region-beginning) (region-end))))
           (region-text (when region
                          (buffer-substring-no-properties (car region) (cdr region))))
           (completions (--> (or completions
                                 (org-roam--get-title-path-completions))
                             (if filter-fn
                                 (funcall filter-fn it)
                               it)))
           (title-with-tags (org-roam-completion--completing-read "File: " completions
                                                                  :initial-input region-text))
           (res (cdr (assoc title-with-tags completions)))
           (title (or (plist-get res :title)
                      title-with-tags))
           (target-file-path (plist-get res :path))
           (description (or description region-text title))
           (link-description (org-roam--format-link-title (if lowercase
                                                              (downcase description)
                                                            description))))
      (if (and target-file-path
               (file-exists-p target-file-path))
          (progn
            (when region ;; Remove previously selected text.
              (delete-region (car region) (cdr region)))
            (insert (org-roam--format-link target-file-path link-description))
            (my/auto-insert-backlinks (buffer-file-name) target-file-path))
        (when (org-roam-capture--in-process-p)
          (user-error "Nested Org-roam capture processes not supported"))
        (let ((org-roam-capture--info `((title . ,title-with-tags)
                                        (slug . ,(org-roam--title-to-slug title-with-tags))))
              (org-roam-capture--context 'title))
          (add-hook 'org-capture-after-finalize-hook #'org-roam-capture--insert-link-h)
          (setq org-roam-capture-additional-template-props (list :region region
                                                                 :link-description link-description
                                                                 :capture-fn 'org-roam-insert))
          (org-roam--with-template-error 'org-roam-capture-templates
            (org-roam-capture--capture))))
      ))

  (defun my/insert-backlinks-with-capture ()
    (my/auto-insert-backlinks
     (plist-get org-capture-plist :original-file)
     (plist-get (plist-get org-capture-plist :org-roam) :file-path))
    (org-roam-capture--insert-link-h))

  (defun my/org-roam-insert-immediate (arg &rest args)
    (interactive "P")
    (let ((args (cons arg args))
          (org-roam-capture-templates (list (append (car org-roam-capture-templates)
                                            '(:immediate-finish t :jump-to-captured nil)))))
      (apply #'org-roam-insert args)))
#+end_src

#+RESULTS:
: my/org-roam-insert-immediate

#+begin_src emacs-lisp
(defun my/org-roam-insert-labels (&optional lowercase completions filter-fn description)
    "Find an Org-roam file, and insert a relative org link to it at point.
  If LOWERCASE, downcase the title before insertion.
  COMPLETIONS is a list of completions to be used instead of
  `org-roam--get-title-path-completions`.
  FILTER-FN is the name of a function to apply on the candidates
  which takes as its argument an alist of path-completions.
  If DESCRIPTION is provided, use this as the link label.  See
  `org-roam--get-title-path-completions' for details."
    (interactive "P")
    (let* ((region (and (region-active-p)
                        ;; following may lose active region, so save it
                        (cons (region-beginning) (region-end))))
           (region-text (when region
                          (buffer-substring-no-properties (car region) (cdr region))))
           (line-no (line-number-at-pos))
           (completions (--> (or completions
                                 (org-roam--get-title-path-completions))
                             (if filter-fn
                                 (funcall filter-fn it)
                               it)))
           (title-with-tags (org-roam-completion--completing-read "File: " completions
                                                                  :initial-input ""))
           (res (cdr (assoc title-with-tags completions)))
           (title (or (plist-get res :title)
                      title-with-tags))
           (target-file-path (plist-get res :path))
           (description (or description region-text title))
           (link-description (org-roam--format-link-title (if lowercase
                                                              (downcase description)
                                                            description))))
      (if (and target-file-path
               (file-exists-p target-file-path))
          (progn
            (when region ;; Remove previously selected text.
              (delete-region (car region) (cdr region)))
            (insert (org-roam--format-link target-file-path link-description))
            (my/auto-insert-labeled-backlinks (buffer-file-name) target-file-path region-text line-no))
        (when (org-roam-capture--in-process-p)
          (user-error "Nested Org-roam capture processes not supported"))
        (let ((org-roam-capture--info `((title . ,title-with-tags)
                                        (slug . ,(org-roam--title-to-slug title-with-tags))))
              (org-roam-capture--context 'title))
          (add-hook 'org-capture-after-finalize-hook #'org-roam-capture--insert-link-h)
          (setq org-roam-capture-additional-template-props (list :region region
                                                                 :link-description link-description
                                                                 :capture-fn 'org-roam-insert))
          (org-roam--with-template-error 'org-roam-capture-templates
            (org-roam-capture--capture))))
      ))
#+end_src

#+RESULTS:
: my/org-roam-insert-labels

#+begin_src emacs-lisp
  (defun my/org-file-get-title (file)
    (with-current-buffer (find-file-noselect file)
      (cadar (org-collect-keywords '("TITLE")))))

  (defun my/auto-insert-backlinks (source-file-path target-file-path &rest args)
    (interactive p)
    (with-current-buffer
        (find-file-noselect target-file-path)
      (unless (ignore-errors
                (org-find-exact-headline-in-buffer "Backlinks"))
        (goto-char (point-max))
        (insert "\n")
        (org-insert-heading nil nil t)
        (insert "Backlinks"))
      (goto-char (org-find-exact-headline-in-buffer "Backlinks"))
      (end-of-line)
      (insert
       (concat "\n- "
               (org-roam--format-link source-file-path (my/org-file-get-title source-file-path))))
      (save-buffer)))

  (defun my/org-roam-format-link-line-no (target &optional description line-no)
  "Formats an org link for a given file TARGET and link DESCRIPTION."
  (let* ((here (ignore-errors
                 (-> (or (buffer-base-buffer)
                         (current-buffer))
                     (buffer-file-name)
                     (file-truename)
                     (file-name-directory)))))
    (org-link-make-string
     (concat "file:" (if here
                         (file-relative-name target here)
                       target) (if line-no (concat "::" (number-to-string line-no)) ""))
     description)))
  (defun my/auto-insert-labeled-backlinks (source-file-path target-file-path  label &optional line-no &rest args)
    (interactive p)
    (with-current-buffer
        (find-file-noselect target-file-path)
      (unless (ignore-errors
                (org-find-exact-headline-in-buffer "References"))
        (goto-char (point-max))
        (insert "\n")
        (org-insert-heading nil nil t)
        (insert "References"))
      (goto-char (org-find-exact-headline-in-buffer "References"))
      (end-of-line)
      (insert
       (concat "\n- "
               (my/org-roam-format-link-line-no source-file-path label line-no)))
      (save-buffer)))

#+end_src

#+RESULTS:
: my/auto-insert-labeled-backlinks

Roam Server
#+begin_src emacs-lisp
(setq org-roam-server-port 9666)
#+end_src

Autolaunch firefox when ever org-roam-server keys are pressed

#+begin_src emacs-lisp
  (defun my/launch-org-roam-firefox(&optional args)
    (interactive "P")
    (if current-prefix-arg 
        (setq org-roam-server-mode nil) (setq org-roam-server-mode t))
    (when org-roam-server-mode
      (my/launch-process "roam-server-process" "*roam-server*" "/Applications/Firefox.app/Contents/MacOS/firefox" "--new-window" "http://localhost:9666/")))
#+end_src

*** Deft
#+begin_src emacs-lisp
(setq deft-directory (concat org-directory "/slipbox"))

(setq deft-extensions '("org"))
(setq deft-default-extension "org")

(setq deft-text-mode 'org-mode)
(setq deft-use-filter-string-for-filename t)

(setq deft-recursive t)
(setq deft-auto-save-interval 0)
#+end_src

Deft new file name convention
#+begin_src emacs-lisp
(setq deft-file-naming-rules
      '((noslash . "-")
        (nospace . "-")
        (case-fn . downcase))))
#+end_src

** Org Present
#+begin_src emacs-lisp
  (add-hook 'org-present-mode-hook
            (lambda ()
              (org-present-big)
              (org-display-inline-images)
              (org-present-read-only)))
  (add-hook 'org-present-mode-quit-hook
            (lambda ()
              (org-present-small)
              (org-remove-inline-images)
              (org-present-read-write)))
#+end_src
#+begin_src emacs-lisp
  (use-package org-tree-slide
    :hook ((org-tree-slide-play . (lambda ()
                (org-display-inline-images)
                (setq text-scale-mode-amount 5)
                (org-present-read-only)
                (text-scale-mode 1)))
           (org-tree-slide-stop . (lambda ()
                (setq text-scale-mode-amount 0)
                (text-scale-mode 1)
                (org-remove-inline-images)
                (org-present-read-write))))
    :custom
    (org-tree-slide-slide-in-effect "End")
    (org-tree-slide-activate-message "Start")
    (org-tree-slide-deactivate-message nil)
    (org-tree-slide-header t)
    (org-tree-slide-breadcrumbs " > ")
    (org-image-actual-width nil))
#+end_src

** Capture Templates                                        :non_exec_block:

#+begin_src emacs-lisp
(setq org-capture-templates
      '(
#+end_src
*** Tasks
#+begin_src emacs-lisp

("t" "Todos")
("tt" "Task [capture]" entry
	 (file+headline capture-file-path "Tasks")
	 "* TODO \nSCHEDULED: %t\n:PROPERTIES:\n:Effort:   %^{Effort}\n:END:\n%i\n%?\n")
#+end_src

Also the home tasks
#+begin_src emacs-lisp
("ts" "Shopping list [home]" checkitem
	 (file+headline home-tasks-file-path "Shopping")
	 "[ ] %i%? ")

("tr" "Reminder [home]" entry
	 (file+headline home-tasks-file-path "Non-Recurring")
	 "* TODO %i%?")
#+end_src

*** Capture
#+begin_src emacs-lisp
("c" "Capture")
("cb" "Book" entry
(file+headline capture-file-path "Books")
"* [[%^{url}][%^{title}]]  %^g
       :PROPERTIES:
       :TYPE: Book
       :END:
")
("cc" "Courses" entry
(file+headline capture-file-path "Courses")
"* TODO [[%^{url}][%^{title}]] %^g
       :PROPERTIES:
       :TYPE: Course
       :END:
")
("cm" "Miscelleneous" entry
(file+headline capture-file-path "Misc")
"* TODO %i%?")
("cv" "Videos" entry
(file+headline capture-file-path "Videos")
"* [[%^{url}][%^{title}]]  %^g
       :PROPERTIES:
       :TYPE: Video
       :END:
")
("cw" "Web URL" entry
(file+headline capture-file-path "Web")
"* [[%^{url}][%^{title}]]  %^g
       :PROPERTIES:
       :TYPE: Web
       :END:
")
#+end_src

*** Journal
#+begin_src emacs-lisp
("j" "Journal")
("jt" "Today" entry
(file+datetree+prompt journal-file-path)
   "* TODO %K %a\nSCHEDULED: %t\n:PROPERTIES:\n:Effort:   %^{Effort}\n:END:\n%i\n%?")
("jj" "Journal" entry
(file+datetree+prompt journal-file-path)
   "* %U %K - %a\n%i\n%?\n")
#+end_src

*** Reference Papers
Capture reference papers with a small help of =C-c b y=
#+begin_src emacs-lisp
("r" "Paper" entry
(file+headline references-file-path "Papers")
	 "*  %^g %i%?
     :PROPERTIES:
     :TYPE: Paper
     :END:
")
#+end_src

*** Secrets
#+begin_src emacs-lisp
	("s" "Secrets" entry
	 (file+headline secrets-file-path "Secrets")
	 "* [[%^{Link}][%^{Description}]]
 :PROPERTIES:
 :USERNAME: %^{Username}
 :PASSWORD: %^{Password}
 :END:
")
#+end_src

*** Closing remarks
#+begin_src emacs-lisp
))

(defun schedule-grocery-hook ()
  (if (string= (org-capture-get :description)
               "Shopping list [home]")
      (org-schedule 0 (format-time-string "%Y-%m-%d"))))

;; (add-hook 'org-capture-before-finalize-hook 'schedule-grocery-hook)
#+end_src

* Internet, Social, Feed Manager
** Elfeed
   Only for laptop
   #+begin_src emacs-lisp :result output
(when (system-is-laptop)
   #+end_src
Feed reader setups
*** Configuration 
[[file:elfeed.org][Configuration Org]]
#+begin_src emacs-lisp
(use-package elfeed-org
  :ensure t
  :config
  (elfeed-org)
  (setq rmh-elfeed-org-files (list "~/.emacs.d/elfeed.org")))
#+end_src
*** Bookmarks
All the bookmark loaders
#+begin_src emacs-lisp
(defun my/elfeed-outline-show-all ()
  (interactive)
  (bookmark-maybe-load-default-file)
  (bookmark-jump "elfeed-all"))

(defun my/elfeed-outline-show-daily ()
  (interactive)
  (bookmark-maybe-load-default-file)
  (bookmark-jump "elfeed-daily"))


(defun my/elfeed-outline-show-tech ()
  (interactive)
  (bookmark-maybe-load-default-file)
  (bookmark-jump "elfeed-tech"))

(defun my/elfeed-outline-art-and-music ()
  (interactive)
  (bookmark-maybe-load-default-file)
  (bookmark-jump "elfeed-artNmusic"))

(defun my/elfeed-outline-show-podcast ()
  (interactive)
  (bookmark-maybe-load-default-file)
  (bookmark-jump "elfeed-podcast"))
#+end_src

*** Customization
Custom functions to make life a little easier
**** Save state before Quit
#+begin_src emacs-lisp
;;write to disk when quiting
(defun my/elfeed-save-db-and-bury ()
  "Wrapper to save the elfeed db to disk before burying buffer"
  (interactive)
  (elfeed-db-save)
  (quit-window))
#+end_src
**** Mark the favourites
#+begin_src emacs-lisp
(defalias 'elfeed-toggle-star
  (elfeed-expose #'elfeed-search-toggle-all 'star))
#+end_src
**** Custom Colors
***** News
#+begin_src emacs-lisp
(defface daily-news
  '((t :foreground "#AFF"))
  "Marks podcasts in Elfeed."
  :group 'elfeed)

(push '(daily daily-news) elfeed-search-face-alist)
#+end_src
***** Podcasts
#+begin_src emacs-lisp
(defface elfeed-audio
  '((t :foreground "#FA0"))
  "Marks podcasts in Elfeed."
  :group 'elfeed)

(push '(podcast elfeed-audio) elfeed-search-face-alist)
#+end_src
***** Technology
#+begin_src emacs-lisp
(defface elfeed-reddit
  '((t :foreground "#0AA"))
  "Marks podcasts in Elfeed."
  :group 'elfeed)

(push '(tech elfeed-reddit) elfeed-search-face-alist)
#+end_src

***** Stars
#+begin_src emacs-lisp
  ;; face for starred articles
  (defface elfeed-search-starred-title-face
    '((t :foreground "#f77"))
    "Marks a starred Elfeed entry."
    :group 'elfeed)

  (push '(star elfeed-search-starred-title-face) elfeed-search-face-alist)
    #+end_src
    
**** Titles, See more titles and Let the computer read out the title ( Mac only)
#+begin_src emacs-lisp
(defun my/outline-show-full-title ()
  (interactive)
  (let ((entry (elfeed-search-selected :single)))
    (message "%s" (propertize (elfeed-entry-title entry)))
))

(defun say (message)
  (call-process "say" nil nil nil message))

(defun my/elfeed-say ()
  (interactive)
  (let ((entry (elfeed-search-selected :single)))
    (say (elfeed-entry-title entry))))

#+end_src

**** In browser open URL
#+begin_src emacs-lisp
(defun my/elfeed-show-visit (&optional use-generic-p)
  "Visit the current entry in your browser using `browse-url'.
If there is a prefix argument, visit the current entry in the
browser defined by `browse-url-generic-program'."
  (interactive "P")
  (let ((link (elfeed-entry-link elfeed-show-entry)))
    (when link
      (message "Sent to browser: %s" link)
      (if use-generic-p
          (browse-url-generic link)
        (browse-web link)))))

#+end_src

*** EMMS Play enclosure
Play an enclosure
#+begin_src emacs-lisp
(defun my/elfeed-outline-show-play-enclosure ()
  "Add enclosure number ENCLOSURE-INDEX from current entry using EMMS."
  (interactive)
  (elfeed-search-untag-all-unread)
  (let ((entry (elfeed-search-selected :single)))
  (setq url-enclosure (car (elt (elfeed-entry-enclosures entry) 0))))
  (emms-add-url url-enclosure))
#+end_src

Play a url at point using mpv
#+begin_src emacs-lisp
  (defun my/play-region (start end)
      "Visit the current entry in mpv."
      (interactive "r")
      (let ((link (if (use-region-p) 
                      (buffer-substring start end))))
            (when link
              (message "Sent to mpv: %s" link)
              (my/launch-process "MPV" "*mpv-video*" "mpv" link))))

  (defun my/play-with-mpv ()
    "Visit the current entry in mpv."
    (interactive)
    (let ((link (url-get-url-at-point)))
          (when link
            (browse-using-mpv link))))

(defun browse-using-mpv (link &rest x)  
  (message "Sent to mpv: %s" link)
  (my/launch-process "ElfeedMPV" "*elfeed-video*" "mpv" link)))
#+end_src

** IRC
Setup for managing IRC 
#+begin_src emacs-lisp
(setq erc-prompt-for-nickserv-password nil)
(defun my/connect-erc () 
(interactive)
(erc 
:server "irc.gotham.chat" :port "6667" :nick "translucentInk" :password nil ))
#+end_src

** Tor
#+begin_src emacs-lisp
  (defun my/launch-tor()
    (interactive)
    (message "Starting Tor sub-process.")
    (my/launch-process "tor-process" "*tor*" "tor")
    (message "Launching Firefox with proxy_profile")
    (when (system-is-laptop)
      (my/launch-process "tor-process" "*tor*" "/Applications/Firefox.app/Contents/MacOS/firefox" "-P" "proxy_firefox" "--new-window" "https://check.torproject.org/"))
    (when (system-is-workstation)
      (my/launch-process "tor-process" "*tor*" "/usr/bin/firefox" "-P" "proxy_firefox" "--new-window" "https://check.torproject.org/"))
    (message "Process launched in *tor* buffer."))
#+end_src

** EWW
Make EWW default
#+begin_src emacs-lisp
  (setq browse-using-mpv "mpv")
  (when (system-is-laptop)
    (setq browse-url-browser-function
          '(("youtube.com" . browse-using-mpv)
            ("youtu.be" . browse-using-mpv)
            ("docs.google.com" . browse-url-default-macosx-browser)  ;; Open google docs in the default browser
            ("trello.com" . browse-url-default-macosx-browser)  ;; Open google docs in the default browser
            ("." . browse-url-default-macosx-browser))))
  (when (system-is-workstation)
    (setq browse-url-browser-function
          '(("youtube.com" . browse-using-mpv)
            ("youtu.be" . browse-using-mpv)
            ("." . browse-url-generic))
          ))
#+end_src

#+begin_src emacs-lisp
  (add-hook 'eww-mode-hook 'visual-line-mode)
  (add-hook 'eww-mode-hook 'toggle-word-wrap)
  (setq eww-header-line-format nil
        shr-width 80
        shr-use-fonts nil
        shr-color-visible-distance-min 10
        shr-color-visible-luminance-min 80)

#+end_src

*** Setup firefox
#+begin_src emacs-lisp
  (setq shr-external-browser 'browse-url-generic)
  (when (system-is-laptop)
    (setq browse-url-generic-program "/Applications/Firefox.app/Contents/MacOS/firefox"))
  (when (system-is-workstation)
    (setq browse-url-generic-program "/usr/bin/firefox"))
#+end_src

* Custom Configurations and Functions
** GIT
Magit and git-gutter configurations
#+begin_src emacs-lisp
(global-git-gutter+-mode t)
(setq git-gutter+-disabled-modes '(asm-mode image-mode))
(set-face-background 'git-gutter+-modified "purple") ;; background color
(set-face-foreground 'git-gutter+-added "green")
(set-face-foreground 'git-gutter+-deleted "red")
#+end_src

git-gutter tramp fix
#+begin_src emacs-lisp
(with-eval-after-load 'git-gutter+
   (defun git-gutter+-remote-default-directory (dir file)
     (let* ((vec (tramp-dissect-file-name file))
            (method (tramp-file-name-method vec))
            (user (tramp-file-name-user vec))
            (domain (tramp-file-name-domain vec))
            (host (tramp-file-name-host vec))
            (port (tramp-file-name-port vec)))
       (tramp-make-tramp-file-name method user domain host port dir)))

   (defun git-gutter+-remote-file-path (dir file)
     (let ((file (tramp-file-name-localname (tramp-dissect-file-name file))))
       (replace-regexp-in-string (concat "\\`" dir) "" file))))
#+end_src


** Kill buffer
Kill buffer asks way too many questions on what to kill, and since I would want to kill what I am on 
#+begin_src emacs-lisp
(defun my/kill-this-buffer ()
  "Kill the current buffer."
  (interactive)
  (kill-buffer (current-buffer)))
#+end_src
** Windows and Frames
Have a easier navigation around open windows
#+begin_src emacs-lisp
(defun prev-window ()
  (interactive)
  (other-window -1))
#+end_src

Move line up and down
#+begin_src emacs-lisp
(defun my/move-line (dir)
  (interactive)
  (next-line)
  (transpose-lines dir)
  (previous-line))
#+end_src

** Basic Text editing
Duplicate an entire line
#+begin_src emacs-lisp
(defun duplicate-line()
  (interactive)
  (move-beginning-of-line 1)
  (kill-line)
  (yank)
  (open-line 1)
  (next-line 1)
  (yank)
  (pop kill-ring)
  (move-beginning-of-line 1)
  )
#+end_src

Get title from a url
#+begin_src emacs-lisp
  (defun www-get-page-title (url)
    (with-current-buffer (url-retrieve-synchronously url)
      (goto-char 0)
      (re-search-forward "<title>\\(.*\\)<[/]title>" nil t 1)
      (match-string 1)))
#+end_src

** View Mode
Open Read-only files in view-mode by default
#+begin_src emacs-lisp
(setq view-read-only t)
#+end_src

View mode can be toggled by ~C-x C-q~.

Give Visual Cue using cursor while in view mode
#+begin_src emacs-lisp
(add-hook 'view-mode-hook
          (defun view-mode-hookee+ ()
            (setq cursor-type (if view-mode 'bar 'box))))

#+end_src
** Volume Control
Current Volume value
Only definable for laptop

#+begin_src emacs-lisp
(when (system-is-laptop)
  (setq my/current-volume (volume-osascript-get))
#+end_src

Mute/UnMute and store current volume
#+begin_src emacs-lisp
  (defun my/volume-mute () 
    (setq my/current-volume (volume-osascript-get))
    (volume-osascript-set 0))

  (defun my/volume-unmute () 
    (volume-osascript-set  my/current-volume))
#+end_src

Increase/Decrease Volume
#+begin_src emacs-lisp
  (defun my/increase-volume (&optional arg) 
    (interactive "p")
    (if current-prefix-arg 
        (my/volume-unmute) (volume-osascript-nudge 1)))

  (defun my/decrease-volume (&optional arg) 
    (interactive "p")
    (if current-prefix-arg 
        (my/volume-mute) (volume-osascript-nudge -1))))
#+end_src

* Hydra
** GIT
#+begin_src emacs-lisp
  (defhydra hydra-magit (:color blue)
    "
    ^
    ^Git  ^             ^Do^
    ^─────^─────────────^──^─────────────
    _n_ Next Hunk       _p_ Previous Hunk
    _w_ Show Hunk       _s_ Stage Hunk
    _q_ Quit            _b_ Blame
    _c_ Clone           _S_ Status
    _i_ Init            _l_ Git Log for file
    "
    ("q" nil)
    ("n" git-gutter+-next-hunk)
    ("p" git-gutter+-previous-hunk)
    ("w" git-gutter+-show-hunk)
    ("s" git-gutter+-stage-hunks)
    ("b" magit-blame)
    ("c" magit-clone)
    ("i" magit-init)
    ("S" magit-status)
    ("l" magit-log-buffer-file))
#+end_src

** Projectile
#+begin_src emacs-lisp
(defhydra hydra-projectile (:color blue)
  "
^
^Projectile^        ^Buffers^           ^Find^              ^Search^
^──────────^────────^───────^───────────^────^──────────────^──────^────────────
_q_ quit            _b_ list            _d_ directory       _r_ replace
_i_ reset cache     _K_ kill all        _D_ root            _R_ regexp replace
^^                  _S_ save all        _f_ file            _s_ ag
^^                  ^^                  _p_ project         ^^
^^                  ^^                  _F_ file-window     ^^
"
  ("q" nil)
  ("b" helm-projectile-switch-to-buffer)
  ("d" helm-projectile-find-dir)
  ("D" projectile-dired)
  ("f" helm-projectile)
  ("F" projectile-find-file-other-window)
  ("i" projectile-invalidate-cache :color red)
  ("K" projectile-kill-buffers)
  ("p" helm-projectile-switch-project)
  ("r" projectile-replace)
  ("R" projectile-replace-regexp)
  ("s" helm-projectile-ag)
  ("S" projectile-save-project-buffers))
#+end_src

** Helm
#+begin_src emacs-lisp
  (defhydra hydra-helm (:color blue)
    "
  ^
  ^Helm^              ^Browse^                ^Python^                    ^Org^                
  ^────^──────────────^──────^────────────────^──────^────────────────────^───^─────────────── 
  _q_ quit            _i_ imenu               _c_ Conda Activate          _P_ Start/Stop Pomodoro
  _r_ resume          _s_ swoop               _d_ Conda Deactivate        _I_ Clock In
  ^^                  _S_ swoop all           _n_ Jupyter Notebooks       _O_ Clock Out
  ^^                  _k_ kill-ring           _N_ Start Jupyter Server    _T_ Tree slide Mode
  ^^                  _m_ Mark Rings          _p_ PyBuild    
  ^^                  ^^
  ^^                  ^^
  "
    ("q" nil)
    ("r" helm-resume)
    ("i" helm-imenu)
    ("m" helm-all-mark-rings)
    ("s" helm-swoop)
    ("S" helm-multi-swoop-all)
    ("k" helm-show-kill-ring)
    ("n" ein:notebooklist-open)
    ("N" ein:jupyter-server-start)
    ("c" pyvenv-workon)
    ("p" py-build)
    ("d" pyvenv-deactivate)
    ("P" org-pomodoro)
    ("T" org-tree-slide-mode)
    ("I" org-clock-in)
    ("O" org-clock-out))
#+end_src

** Org
*** org-ref
Org-ref Sugars

#+begin_src emacs-lisp
  (setq live-references-folder (concat org-roam-directory "/references/live-notes"))
  (setq tablet-references-folder (concat org-roam-directory "/references/tablet"))

  (defhydra hydra-org-ref (:color blue)
    "
    ^
    ^Org-ref^                 ^Do^                  ^Go To^ 
    ^─────^───────────────────^──^──────────────────^─────^──────────────────
    _l_ Create label          _i_ Insert Reference  _L_ Live Notes 
    _b_ Add doi bibtex        _y_ Bibtex Yank       _T_ Tablet Sync 
    _A_ Add arxiv bibtex      _a_ Arxiv Search       
    _q_ Quit                  ^^
    ^^                        ^^                     
    ^^                        ^^                     
    ^^                        ^^                     
    "
    ("q" nil)
    ("l" org-ref-helm-insert-label-link) 
    ("i" org-ref-insert-cite-link)
    ("b" doi-add-bibtex-entry)
    ("A" arxiv-add-bibtex-entry)
    ("a" arxiv-lookup)
    ("L" (dired live-references-folder))
    ("T" (dired tablet-references-folder))
    ("y" org-bibtex-yank))
#+end_src
*** Org-roam
#+begin_src emacs-lisp
  (defhydra hydra-org-roam (:color blue)
    "
    ^
    ^Org-roam^                  ^Note^                    ^Search^                  
    ^─────^─────────────────────^────^────────────────────^────^──────────────────
    _r_ Org-Roam                _c_ Create New Note       _d_ Deft
    _f_ Roam Find Files         _T_ Create for today      _s_ Switch Buffer
    _i_ Insert Link reference   _t_ Insert Tags           _b_ Backlink Mode
    _0_ Roam Index              _l_ Label region  
    _q_ Quit                    ^^                      
    ^^                          ^^                      
    ^^                          ^^                      
    ^^                          ^^                      
    "
    ("q" nil)
    ("r" org-roam)
    ("f" org-roam-find-file)
    ("i" my/org-roam-insert-immediate)
    ("b" org-roam-backlinks-mode)
    ("c" org-roam-capture)
    ("d" deft)
    ("s" org-roam-switch-to-buffer)
    ("T" org-roam-dailies-today)
    ("t" my/org-roam-insert-tags)
    ("l" my/org-roam-insert-labels)
    ("0" org-roam-jump-to-index))
#+end_src

#+RESULTS:
: hydra-org-ref-more/body

** Music Player
Spotify sugars
#+begin_src emacs-lisp
(when (system-is-laptop)
  (defhydra hydra-spotify (:color blue)
    "
    ^
    ^Spotify  ^             ^Do^
    ^────────^──────────────^──^─────────────
    _p_ Play/Pause          _N_ Next
    _s_ Stop                _P_ Previous
    _q_ Quit            
    "
    ("q" nil)
    ("p" spotify-playpause)
    ("N" spotify-next)
    ("P" spotify-previous)
    ("s" spotify-quit))
#+end_src

EMMS
#+begin_src emacs-lisp
(defhydra hydra-emms (:color blue)
  "
  ^
  ^  EMMS  ^              ^Do^
  ^────────^──────────────^──^─────────────
  _p_ Play/Pause          _N_ Next
  _s_ Stop                _P_ Previous
  _q_ Quit                _R_ Reload Playlist
  "
  ("q" nil)
  ("R" my/reload-playlist)
  ("p" emms-pause)
  ("N" emms-next)
  ("P" emms-previous)
  ("s" emms-stop)))
#+end_src

** Internet, Social, Feed Manager
Hydra Menu for elfeed
#+begin_src emacs-lisp
(defhydra hydra-social-feed (:color blue)
  "
  ^
  ^Internet^       ^Social^     
  ^────────^───────^──────^─────
  _p_ Tor          _e_ El Feed
  _b_ EWW          _i_ IRC
  _q_ Quit            
  "
  ("q" nil)
  ("e" elfeed)
  ("b" browse-web)
  ("i" my/connect-erc)
  ("p" my/launch-tor))
#+end_src

** Window Move
Quickly move around windows
#+begin_src emacs-lisp
(defhydra hydra-window-move (:color blue)
  "
  ^
  ^Window  ^              
  ^────────^───────────^─────^─────────────
  _p_ Move Up          _n_ Move Down
  _b_ Move Left        _f_ Move Right
  _q_ Quit            
  "
  ("q" nil)
  ("p" windmove-up)
  ("n" windmove-down)
  ("b" windmove-left)
  ("f" windmove-right))
#+end_src

* Key Bindings
Define custom key bindings.
** Windows and Frames
Basic key bindings to play around with frames and window. Binding Delete frame defaulted at  =C-x 5 0= to =C-x w=

|----------------+--------------|
| Action         | Key Binding  |
|----------------+--------------|
| Delete Frame   | =C-x w=        |
| Increase Font  | =C-+=, =C-x C-== |
| Decrease Font  | =C--=          |
| Forward Window | =s->=, =s-'=     |
| Prev Window    | =s-<=          |
|----------------+--------------|


#+begin_src emacs-lisp
(global-set-key (kbd "C-x w") 'delete-frame)
(global-set-key (kbd "C-x C-b") 'switch-to-buffer)
(global-set-key (kbd "C-x C-d") 'dired)
(global-set-key (kbd "s-<return>") 'toggle-frame-fullscreen)
(global-set-key (kbd "C-+") 'text-scale-increase)
(global-set-key (kbd "C--") 'text-scale-decrease)
(global-set-key (kbd "s->") #'other-window)
(global-set-key (kbd "s-'") #'other-window)
(global-set-key (kbd "s-<") #'prev-window)
#+end_src


Scroll Without moving point
#+begin_src emacs-lisp
(global-set-key (kbd "C-v") #'scroll-up-line)
(global-set-key (kbd "M-v") #'scroll-down-line)
#+end_src

Jump to next occurrence of the symbol
#+begin_src emacs-lisp
(global-set-key (kbd "M-n") 'smartscan-symbol-go-forward)
(global-set-key (kbd "M-p") 'smartscan-symbol-go-backward)
#+end_src

Move line up and down
#+begin_src emacs-lisp
(global-set-key (kbd "M-<up>") (lambda () (interactive) (my/move-line -1)))
(global-set-key (kbd "M-<down>") (lambda () (interactive) (my/move-line 1)))
#+end_src

*** Shell
Have a Doom styled console launch binding
#+begin_src emacs-lisp
  (global-set-key (kbd "s-`") 'vterm)
  (global-set-key (kbd "s-1") (lambda () (interactive) (eshell 'N)))
#+end_src

=term= font and styling
#+begin_src emacs-lisp

(defun my/term-face () 
(interactive)
(setq buffer-face-mode-face '(:family "Source Code Pro" :height 115 ))
   (buffer-face-mode t)
)

(add-hook 'vterm-mode-hook 'my/term-face)
(add-hook 'eshell-mode-hook 'my/term-face)
#+end_src

** Basic Text editing

Duplicate a line
#+begin_src emacs-lisp
(global-set-key (kbd "C-c d") 'duplicate-line)
#+end_src

Mark occurrences ( Rudimentary version of iedit)
#+begin_src emacs-lisp
(global-set-key (kbd "C->") 'mc/mark-next-like-this)
(global-set-key (kbd "C-<") 'mc/mark-previous-like-this)
(global-set-key (kbd "C-s-<mouse-1>") 'mc/add-cursor-on-click)
#+end_src

Expand Region
#+begin_src emacs-lisp
(global-set-key (kbd "C-=") 'er/expand-region)
#+end_src

Track the last edited location
#+begin_src emacs-lisp
(global-set-key (kbd "M-s-<left>") 'goto-last-change)
(global-set-key (kbd "M-s-<right>") 'goto-last-change-reverse)
#+end_src

Define word at point 
#+begin_src emacs-lisp
(global-set-key (kbd "M-#") 'lookup-word)
#+end_src

Push point to mark ring
#+begin_src emacs-lisp
(global-set-key (kbd "C-`") 'push-mark-no-activate)
#+end_src

** Evil
Remap =/= to <spc>
#+begin_src example
(with-eval-after-load 'evil-maps
  (define-key evil-motion-state-map (kbd "SPC") 'evil-search-forward))
#+end_src
** GIT
Git key bindings, with added sugar of hydra
#+begin_src emacs-lisp
(global-set-key (kbd "C-c g") 'magit-status)
(global-set-key (kbd "C-c m") 'hydra-magit/body)
#+end_src

** Projectile
#+begin_src emacs-lisp
(global-set-key (kbd "C-c p") 'hydra-projectile/body)
#+end_src

** Kill buffer
Just kill the current buffer without asking too many questions
#+begin_src emacs-lisp
(global-set-key (kbd "C-x k") 'my/kill-this-buffer)
#+end_src

** Helm
Have helm handle most of the things around

#+begin_src emacs-lisp
  (global-set-key (kbd "M-x") #'helm-M-x)
  (global-set-key (kbd "M-y") 'helm-show-kill-ring)
  (global-set-key (kbd "C-x r b") #'helm-filtered-bookmarks)
  (global-set-key (kbd "C-x C-f") #'helm-find-files)
  (global-set-key (kbd "C-c h") 'hydra-helm/body)
  (global-set-key (kbd "C-x p") 'ivy-bibtex)
  (global-set-key (kbd "C-x b") 'helm-mini)
  (global-set-key (kbd "C-x C-b") 'helm-projectile-switch-to-buffer)
  (define-key dired-mode-map  (kbd "C-x C-q") 'wdired-change-to-wdired-mode)
#+end_src

#+RESULTS:
: wdired-change-to-wdired-mode

** Org
Links agendas and capture templates
#+begin_src emacs-lisp
  (global-set-key (kbd "C-c l") 'org-store-link)
  (global-set-key (kbd "C-c a") 'org-agenda)
  (global-set-key (kbd "C-c A") 'cfw:open-org-calendar)
  (global-set-key (kbd "C-c c") 'org-capture)
#+end_src

References, Publications and Citations
#+begin_src emacs-lisp
  (setq org-ref-insert-cite-key "C-c M-]")
#+end_src


Org-ref hydra sugar
#+begin_src emacs-lisp
(global-set-key (kbd "C-c b") 'hydra-org-ref/body)
#+end_src

#+RESULTS:
: hydra-org-ref/body

Org-roam
#+begin_src emacs-lisp
 (global-set-key (kbd "C-c r") 'hydra-org-roam/body)
#+end_src

#+RESULTS:
: hydra-org-roam/body

Updating =org-noter-set-doc-split-fraction= in-order to split window with a specific ratio every time org-noter launches. Existing function is kept same, except for the split ratio
#+begin_src emacs-lisp
    (setq org-noter-doc-split-ratio '(0.8 .0.5))

    (defun my/org-noter (&optional args)
      (interactive)
      (if (not
           (org-entry-properties nil org-noter--property-doc-split-fraction))
           (org-entry-put nil org-noter--property-doc-split-fraction (format "%s" org-noter-doc-split-ratio)))
        (org-noter))
  (define-key org-mode-map (kbd "C-c i") 'my/org-noter)
#+end_src

#+RESULTS:
: my/org-noter

PDF View
#+begin_src emacs-lisp
(define-key pdf-view-mode-map (kbd "j") 'pdf-view-next-line-or-next-page)
(define-key pdf-view-mode-map (kbd "k") 'pdf-view-previous-line-or-previous-page)
(define-key pdf-view-mode-map (kbd "l") 'image-forward-hscroll)
(define-key pdf-view-mode-map (kbd "h") 'image-backward-hscroll)
(define-key pdf-view-mode-map (kbd "C-c C-d") 'pdf-view-midnight-minor-mode)
(define-key pdf-view-mode-map (kbd "C-s") 'isearch-forward)
#+end_src

Tree slide mode
#+begin_src emacs-lisp
  (define-key org-tree-slide-mode-map (kbd "j") 'org-tree-slide-move-next-tree)
  (define-key org-tree-slide-mode-map (kbd "k") 'org-tree-slide-move-previous-tree)
  (define-key org-tree-slide-mode-map (kbd "q") 'org-tree-slide-mode)
#+end_src

#+RESULTS:
: org-tree-slide-mode

** Audio / Multimedia
Music Player
#+begin_src emacs-lisp
(when (system-is-laptop)
  (global-set-key (kbd "C-c s") 'hydra-emms/body)
  (global-set-key (kbd "C-c S") 'hydra-spotify/body)
#+end_src

|-----------------+-------------|
| Volume Control  | Key Binding |
|-----------------+-------------|
| Increase volume | =s-+=         |
| Decrease Volume | =s--=         |
| Mute Volume     | =C-u s--=     |
| Un Mute Volume  | =C-u s-+=     |
|-----------------+-------------|

#+begin_src emacs-lisp
(global-set-key (kbd "s-+") 'my/increase-volume)
(global-set-key (kbd "s-=") 'my/increase-volume)
(global-set-key (kbd "s--") 'my/decrease-volume))
#+end_src

** Json
Pretty print JSON buffer
#+begin_src emacs-lisp
(define-key json-mode-map (kbd "C-M-/") 'json-pretty-print-buffer)
#+end_src
** Python
Pytest keybinding in python mode
#+begin_src emacs-lisp
(define-key python-mode-map (kbd "C-c t") 'python-pytest-popup)
(define-key elpy-mode-map (kbd "C-c C-t") 'python-pytest-file)
#+end_src

#+RESULTS:
: python-pytest-file

** Password Manager
#+begin_src emacs-lisp
(when (system-is-laptop)
  (define-key org-mode-map (kbd "C-c C-p C-g") 'password-generator-phonetic)
  (define-key org-mode-map (kbd "C-c C-p C-p") 'org-get-pin))
#+end_src
** EWW / Social Feed
#+begin_src emacs-lisp
(when (system-is-laptop)
  (global-set-key (kbd "C-c f") 'hydra-social-feed/body)
  (global-set-key (kbd "C-c O") 'my/play-with-mpv)
#+end_src

Custom open links at point
#+begin_src emacs-lisp
(define-key elfeed-show-mode-map (kbd "o") 'my/elfeed-show-visit)
#+end_src

#+begin_src emacs-lisp
  (define-key eww-mode-map "j" 'next-line)
  (define-key eww-mode-map "k" 'previous-line)
#+end_src

*** Elfeed bookmarks and custom keymaps

#+begin_src emacs-lisp
(use-package elfeed
  :ensure t
  :bind (:map elfeed-search-mode-map
              ("A" . my/elfeed-outline-show-all)
              ("M" . my/elfeed-outline-art-and-music)
              ("D" . my/elfeed-outline-show-daily)
              ("T" . my/elfeed-outline-show-tech)
              ("P" . my/elfeed-outline-show-podcast)
              (">" . my/elfeed-outline-show-play-enclosure)
              ("x" . my/elfeed-say)
              ("*" . elfeed-toggle-star)
              ("<SPC>" . my/outline-show-full-title))))
#+end_src

** View Mode
Disable view-mode using ~e~  (=view-exit=)

Remap movement keys to ~b~, ~f~, ~n~ and ~p~
#+begin_src emacs-lisp
(define-key view-mode-map (kbd "b") 'backward-char)
(define-key view-mode-map (kbd "f") 'forward-char)
(define-key view-mode-map (kbd "n") 'next-line)
(define-key view-mode-map (kbd "p") 'previous-line)
#+end_src

Also add basic vim key bindings:  ~h~, ~l~, ~j~ and ~k~

#+begin_src emacs-lisp
(define-key view-mode-map (kbd "h") 'backward-char)
(define-key view-mode-map (kbd "l") 'forward-char)
(define-key view-mode-map (kbd "j") 'next-line)
(define-key view-mode-map (kbd "k") 'previous-line)
#+end_src

Remap scroll screen and previous screen to ~v~ and ~V~
#+begin_src emacs-lisp
(define-key view-mode-map (kbd "v") 'scroll-up-command)
(define-key view-mode-map (kbd "V") 'scroll-down-command)
#+end_src

Remap recenter-top-bottom ~l~
#+begin_src emacs-lisp
 (define-key view-mode-map (kbd "l") 'recenter-top-bottom)
#+end_src

** Jupyter Notebooks
Create a new Notebook
#+begin_src emacs-lisp
(define-key ein:notebooklist-mode-map (kbd "C-c C-n") 'ein:notebooklist-new-notebook)
#+end_src

Execute all cells
#+begin_src emacs-lisp
(define-key ein:notebook-mode-map (kbd "C-c C-e") 'ein:worksheet-execute-all-cell)
#+end_SEC
